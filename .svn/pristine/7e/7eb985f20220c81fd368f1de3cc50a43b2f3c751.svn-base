"use strict";(self["webpackChunknavy"]=self["webpackChunknavy"]||[]).push([[69],{20892:()=>{var e;(function(e){const t=6777e3;let i;function r(e,t){return{isError:!0,code:e,message:t}}(function(e){e[e["SETUP"]=t+1]="SETUP",e[e["LOAD"]=t+2]="LOAD",e[e["PURCHASE"]=t+3]="PURCHASE",e[e["LOAD_RECEIPTS"]=t+4]="LOAD_RECEIPTS",e[e["CLIENT_INVALID"]=t+5]="CLIENT_INVALID",e[e["PAYMENT_CANCELLED"]=t+6]="PAYMENT_CANCELLED",e[e["PAYMENT_INVALID"]=t+7]="PAYMENT_INVALID",e[e["PAYMENT_NOT_ALLOWED"]=t+8]="PAYMENT_NOT_ALLOWED",e[e["UNKNOWN"]=t+10]="UNKNOWN",e[e["REFRESH_RECEIPTS"]=t+11]="REFRESH_RECEIPTS",e[e["INVALID_PRODUCT_ID"]=t+12]="INVALID_PRODUCT_ID",e[e["FINISH"]=t+13]="FINISH",e[e["COMMUNICATION"]=t+14]="COMMUNICATION",e[e["SUBSCRIPTIONS_NOT_AVAILABLE"]=t+15]="SUBSCRIPTIONS_NOT_AVAILABLE",e[e["MISSING_TOKEN"]=t+16]="MISSING_TOKEN",e[e["VERIFICATION_FAILED"]=t+17]="VERIFICATION_FAILED",e[e["BAD_RESPONSE"]=t+18]="BAD_RESPONSE",e[e["REFRESH"]=t+19]="REFRESH",e[e["PAYMENT_EXPIRED"]=t+20]="PAYMENT_EXPIRED",e[e["DOWNLOAD"]=t+21]="DOWNLOAD",e[e["SUBSCRIPTION_UPDATE_NOT_AVAILABLE"]=t+22]="SUBSCRIPTION_UPDATE_NOT_AVAILABLE",e[e["PRODUCT_NOT_AVAILABLE"]=t+23]="PRODUCT_NOT_AVAILABLE",e[e["CLOUD_SERVICE_PERMISSION_DENIED"]=t+24]="CLOUD_SERVICE_PERMISSION_DENIED",e[e["CLOUD_SERVICE_NETWORK_CONNECTION_FAILED"]=t+25]="CLOUD_SERVICE_NETWORK_CONNECTION_FAILED",e[e["CLOUD_SERVICE_REVOKED"]=t+26]="CLOUD_SERVICE_REVOKED",e[e["PRIVACY_ACKNOWLEDGEMENT_REQUIRED"]=t+27]="PRIVACY_ACKNOWLEDGEMENT_REQUIRED",e[e["UNAUTHORIZED_REQUEST_DATA"]=t+28]="UNAUTHORIZED_REQUEST_DATA",e[e["INVALID_OFFER_IDENTIFIER"]=t+29]="INVALID_OFFER_IDENTIFIER",e[e["INVALID_OFFER_PRICE"]=t+30]="INVALID_OFFER_PRICE",e[e["INVALID_SIGNATURE"]=t+31]="INVALID_SIGNATURE",e[e["MISSING_OFFER_PARAMS"]=t+32]="MISSING_OFFER_PARAMS"})(i=e.ErrorCode||(e.ErrorCode={})),e.storeError=r})(e||(e={})),function(e){class t{constructor(t,i){this.config=t,t.url||(t.url="https://validator.iaptic.com"),this.store=null!==i&&void 0!==i?i:e.store,this.log=this.store.log.child("Iaptic")}get braintreeClientTokenProvider(){return t=>{this.log.info("Calling Braintree clientTokenProvider"),e.Utils.ajax(this.log,{url:`${this.config.url}/v3/braintree/client-token?appName=${this.config.appName}&apiKey=${this.config.apiKey}`,method:"POST",data:{applicationUsername:e.store.getApplicationUsername(),customerId:e.Braintree.customerId},success:e=>{this.log.info("clientTokenProvider success: "+JSON.stringify(e)),t(e.clientToken)},error:i=>{this.log.info("clientTokenProvider error: "+JSON.stringify(i)),t(e.storeError(i,"ERROR "+i))}})}}get appStoreDiscountEligibilityDeterminer(){let t;return this.log.debug("AppStore eligibility determiner is listening..."),this.store.when().verified((i=>{i.platform===e.Platform.APPLE_APPSTORE&&(this.log.debug("Got a verified AppStore receipt."),t=i)})),(r,o,n)=>{if(this.log.debug("AppStore eligibility determiner"),t)return this.log.debug("Using cached receipt"),n(i(t,o));const s=t=>{t.platform===e.Platform.APPLE_APPSTORE&&(this.log.debug("Receipt is verified, let's analyze the content and respond."),this.store.off(s),n(i(t,o)))};this.log.debug("Waiting for receipt"),this.store.when().verified(s)};function i(e,t){const i=e.raw.ineligible_for_intro_price;return t.map((t=>{var r;if("Introductory"===t.discountType&&i&&i.find((e=>t.productId===e)))return!1;if("Subscription"===t.discountType){const i=null===(r=e.raw.collection)||void 0===r?void 0:r.find((e=>e.id===t.productId));return!!i}return!0}))}}get validator(){return`${this.config.url}/v1/validate?appName=${this.config.appName}&apiKey=${this.config.apiKey}`}}e.Iaptic=t}(e||(e={})),function(e){let t;(function(e){e[e["QUIET"]=0]="QUIET",e[e["ERROR"]=1]="ERROR",e[e["WARNING"]=2]="WARNING",e[e["INFO"]=3]="INFO",e[e["DEBUG"]=4]="DEBUG"})(t=e.LogLevel||(e.LogLevel={}));class i{constructor(e,t=""){this.prefix="",this.store=e,this.prefix=t||"CdvPurchase"}child(e){return new i(this.store,this.prefix+"."+e)}error(e){n(this.store.verbosity,t.ERROR,this.prefix,e);try{throw new Error(o(e))}catch(i){n(this.store.verbosity,t.ERROR,this.prefix,i.stack)}}warn(e){n(this.store.verbosity,t.WARNING,this.prefix,e)}info(e){n(this.store.verbosity,t.INFO,this.prefix,e)}debug(e){n(this.store.verbosity,t.DEBUG,this.prefix,e)}logCallbackException(e,t){if(this.warn("A callback in '"+e+"' failed with an exception."),"string"===typeof t)this.warn("           "+t);else if(t){const e=t;e.fileName&&this.warn("           "+e.fileName+":"+e.lineNumber),t.message&&this.warn("           "+t.message),t.stack&&this.warn("           "+t.stack)}}}i.console=window.console,e.Logger=i;const r=["QUIET","ERROR","WARNING","INFO","DEBUG"];function o(e){return"string"!==typeof e&&(e=JSON.stringify(e)),e}function n(e,o,n,s){var a=!0===e?1:e;if(o>a)return;"string"!==typeof s&&(s=JSON.stringify(s));const c=n?`[${n}] `:"",l=o===t.ERROR?e=>i.console.error(e):o===t.WARNING?e=>i.console.warn(e):e=>i.console.log(e);r[o]?l(`${c}${r[o]}: ${s}`):l(`${c}${s}`)}}(e||(e={})),function(e){let t;(function(e){e.nonEnumerable=(e,t,i)=>{if(i)return i.enumerable=!1,i;Object.defineProperty(e,t,{set(e){Object.defineProperty(this,t,{value:e,writable:!0,configurable:!0})},configurable:!0})}})(t=e.Utils||(e.Utils={}))}(e||(e={})),function(e){class t{constructor(e,t){this.className="Product",this.title="",this.description="",this.platform=e.platform,this.type=e.type,this.id=e.id,this.group=e.group,this.offers=[],Object.defineProperty(this,"pricing",{enumerable:!1,get:()=>{var e;return null===(e=this.offers[0])||void 0===e?void 0:e.pricingPhases[0]}}),Object.defineProperty(this,"canPurchase",{enumerable:!1,get:()=>t.canPurchase(this)}),Object.defineProperty(this,"owned",{enumerable:!1,get:()=>t.owned(this)})}get pricing(){var e;return null===(e=this.offers[0])||void 0===e?void 0:e.pricingPhases[0]}get canPurchase(){return!1}get owned(){return!1}getOffer(e=""){return e?this.offers.find((t=>t.id===e)):this.offers[0]}addOffer(e){return this.getOffer(e.id)||this.offers.push(e),this}}e.Product=t}(e||(e={})),function(e){let t;(function(t){class i{constructor(){this.array=[]}get length(){return this.array.length}get(){return this.array.concat()}add(e){this.has(e)||this.array.push(e)}clear(){while(0!==this.array.length)this.array.pop()}has(e){return!!this.array.find((t=>t===e))}}t.ReceiptsToValidate=i;class r{constructor(e,t){this.receiptsToValidate=new i,this.verifiedReceipts=[],this.numRequests=0,this.numResponses=0,this.cache={},this.controller=e,this.log=t.child("Validator")}incrRequestsCounter(){this.numRequests=this.numRequests+1|0,this.log.debug(`Validation requests=${this.numRequests} responses=${this.numResponses}`)}incrResponsesCounter(){this.numResponses=this.numResponses+1|0,this.log.debug(`Validation requests=${this.numRequests} responses=${this.numResponses}`)}addVerifiedReceipt(t,i){for(const e of this.verifiedReceipts)if(e.platform===t.platform&&e.id===i.id)return this.log.debug("Updating existing receipt."),e.set(t,i),e;this.log.debug("Register a new verified receipt.");const r=new e.VerifiedReceipt(t,i,this.controller);return this.verifiedReceipts.push(r),r}add(t){this.log.debug("Schedule validation: "+JSON.stringify(t));const i=t instanceof e.Transaction?t.parentReceipt:t;this.receiptsToValidate.has(i)||(this.incrRequestsCounter(),this.receiptsToValidate.add(i))}run(){const t=this.receiptsToValidate.get();this.receiptsToValidate.clear();const i=async t=>{const{receipt:i,payload:r}=t;this.incrResponsesCounter();try{const e=this.controller.adapters.find(i.platform);if(await(null===e||void 0===e?void 0:e.handleReceiptValidationResponse(i,r)),r.ok){const e=this.addVerifiedReceipt(i,r.data);this.controller.verifiedCallbacks.trigger(e)}else this.controller.unverifiedCallbacks.trigger({receipt:i,payload:r})}catch(o){this.log.error("Exception probably caused by an invalid response from the validator."+o.message),this.controller.unverifiedCallbacks.trigger({receipt:i,payload:{ok:!1,code:e.ErrorCode.VERIFICATION_FAILED,message:o.message}})}};t.forEach((e=>this.runOnReceipt(e,i)))}async runOnReceipt(t,i){if(t.platform===e.Platform.TEST)return this.log.debug("Using Test Adapter mock verify function."),e.Test.Adapter.verify(t,i);if(!this.controller.validator)return void this.incrResponsesCounter();const r=await this.buildRequestBody(t);if(!r)return void this.incrResponsesCounter();if("function"===typeof this.controller.validator)return this.runValidatorFunction(this.controller.validator,t,r,i);const o="string"===typeof this.controller.validator?{url:this.controller.validator,timeout:2e4}:this.controller.validator;return this.runValidatorRequest(o,t,r,i)}runValidatorFunction(e,t,i,r){try{e(i,(e=>r({receipt:t,payload:e})))}catch(o){this.log.warn("user provided validator function failed with error: "+(null===o||void 0===o?void 0:o.stack))}}async buildRequestBody(t){var i,r,o;const n=this.controller.adapters.find(t.platform),s=await(null===n||void 0===n?void 0:n.receiptValidationBody(t));if(s){if(s.additionalData=Object.assign(Object.assign({},null!==(i=s.additionalData)&&void 0!==i?i:{}),{applicationUsername:this.controller.getApplicationUsername()}),s.additionalData.applicationUsername||delete s.additionalData.applicationUsername,s.device=Object.assign(Object.assign({},null!==(r=s.device)&&void 0!==r?r:{}),e.Validator.Internal.getDeviceInfo(this.controller)),1===(null===(o=s.offers)||void 0===o?void 0:o.length)){const e=s.offers[0];if(1===e.pricingPhases.length){const t=e.pricingPhases[0];s.currency=t.currency,s.priceMicros=t.priceMicros}else if(2===e.pricingPhases.length){const t=e.pricingPhases[1];s.currency=t.currency,s.priceMicros=t.priceMicros;const i=e.pricingPhases[0];s.introPriceMicros=i.priceMicros}}return s}}removeExpiredCache(){const e=+new Date,t=[];for(const i in this.cache)this.cache[i].expires<e&&t.push(i);for(const i of t)delete this.cache[i]}runValidatorRequest(t,i,r,n){this.removeExpiredCache();const s=e.Utils.md5(JSON.stringify(r.transaction)),a=this.cache[s];if(a)return n({receipt:i,payload:a.payload});e.Utils.ajax(this.log.child("Ajax"),{url:t.url,method:"POST",customHeaders:t.headers,timeout:t.timeout,data:r,success:t=>{var r;if(this.log.debug("validator success, response: "+JSON.stringify(t)),!o(t))return n({receipt:i,payload:{ok:!1,code:e.ErrorCode.BAD_RESPONSE,message:"Validator responded with invalid data",data:{latest_receipt:null===(r=null===t||void 0===t?void 0:t.data)||void 0===r?void 0:r.latest_receipt}}});this.cache[s]={payload:t,expires:+new Date+12e4},n({receipt:i,payload:t})},error:(t,r,o)=>{var s="Error "+t+": "+r;this.log.debug("validator failed, response: "+JSON.stringify(s)),this.log.debug("body => "+JSON.stringify(o)),n({receipt:i,payload:{ok:!1,message:s,code:e.ErrorCode.COMMUNICATION,status:t,data:{}}})}})}}function o(e){return!!e&&"object"===typeof e&&"ok"in e&&"boolean"===typeof e.ok}t.Validator=r})(t=e.Internal||(e.Internal={}))}(e||(e={})),function(e){let t;(function(t){class i{constructor(){this.list=[]}add(t,i,r){i.forEach((i=>{if(t.info(""),!this.find(i.platform))switch(i.platform){case e.Platform.APPLE_APPSTORE:return this.list.push(new e.AppleAppStore.Adapter(r,i.options||{}));case e.Platform.GOOGLE_PLAY:return this.list.push(new e.GooglePlay.Adapter(r));case e.Platform.BRAINTREE:return i.options||t.error("Options missing for Braintree initialization. Use {platform: Platform.BRAINTREE, options: {...}} in your call to store.initialize"),this.list.push(new e.Braintree.Adapter(r,i.options));case e.Platform.TEST:default:return this.list.push(new e.Test.Adapter(r))}}))}async initialize(t,i){const r=t.map((e=>"string"===typeof e?{platform:e}:e)).filter((e=>!this.find(e.platform))),o=i.log.child("Adapters");o.info("Adding platforms: "+JSON.stringify(r)),this.add(o,r,i);const n=i.registeredProducts.byPlatform(),s=await Promise.all(r.map((async t=>{var r,s,a;const c=null!==(a=null===(s=null===(r=n.filter((e=>e.platform===t.platform)))||void 0===r?void 0:r[0])||void 0===s?void 0:s.products)&&void 0!==a?a:[],l=this.find(t.platform);if(!l)return;if(o.info(`${l.name} initializing...`),!l.isSupported)return void o.info(`${l.name} is not supported.`);const d=await l.initialize();if(l.ready=!0,o.info(`${l.name} initialized. ${d?JSON.stringify(d):""}`),null===d||void 0===d?void 0:d.code)return d;if(o.info(`${l.name} products: ${JSON.stringify(c)}`),0===c.length)return;const u=await l.loadProducts(c);o.info(`${l.name} products loaded: ${JSON.stringify(u)}`);const p=u.filter((t=>t instanceof e.Product));i.listener.productsUpdated(t.platform,p);const h=await l.loadReceipts();return o.info(`${l.name} receipts loaded: ${JSON.stringify(h)}`),u.filter((e=>"code"in e&&"message"in e))[0]})));return s.filter((e=>e))}find(e){return this.list.filter((t=>t.id===e))[0]}findReady(e){return this.list.filter((t=>(!e||t.id===e)&&t.ready))[0]}}t.Adapters=i})(t=e.Internal||(e.Internal={}))}(e||(e={})),function(e){let t;(function(t){class i{constructor(e,t,i=!1){this.callbacks=[],this.numTriggers=0,this.logger=e,this.className=t,this.finalStateMode=i}push(e){this.finalStateMode&&this.numTriggers>0?e(this.lastTriggerArgument):this.callbacks.push(e)}trigger(t){this.lastTriggerArgument=t,this.numTriggers++;const i=this.callbacks;this.finalStateMode&&(this.callbacks=[]),i.forEach((i=>{e.Utils.safeCall(this.logger,this.className,i,t)}))}remove(e){this.callbacks=this.callbacks.filter((t=>t!==e))}}t.Callbacks=i})(t=e.Internal||(e.Internal={}))}(e||(e={})),function(e){let t;(function(t){class i{constructor(e){this.isReady=!1,this.readyCallbacks=[],this.logger=e}add(e){if(this.isReady)return setTimeout(e,0);this.readyCallbacks.push(e)}trigger(){this.isReady=!0,this.readyCallbacks.forEach((t=>e.Utils.safeCall(this.logger,"ready()",t,void 0))),this.readyCallbacks=[]}remove(e){this.readyCallbacks=this.readyCallbacks.filter((t=>t!==e))}}t.ReadyCallbacks=i})(t=e.Internal||(e.Internal={}))}(e||(e={})),function(e){e.PLUGIN_VERSION="13.6.0";class t{constructor(){this.adapters=new e.Internal.Adapters,this.registeredProducts=new e.Internal.RegisteredProducts,this.log=new e.Logger(this),this.verbosity=e.LogLevel.ERROR,this._readyCallbacks=new e.Internal.ReadyCallbacks(this.log),this.updatedCallbacks=new e.Internal.Callbacks(this.log,"productUpdated()"),this.updatedReceiptsCallbacks=new e.Internal.Callbacks(this.log,"receiptUpdated()"),this.approvedCallbacks=new e.Internal.Callbacks(this.log,"approved()"),this.finishedCallbacks=new e.Internal.Callbacks(this.log,"finished()"),this.pendingCallbacks=new e.Internal.Callbacks(this.log,"pending()"),this.verifiedCallbacks=new e.Internal.Callbacks(this.log,"verified()"),this.unverifiedCallbacks=new e.Internal.Callbacks(this.log,"unverified()"),this.receiptsReadyCallbacks=new e.Internal.Callbacks(this.log,"receiptsReady()",!0),this.receiptsVerifiedCallbacks=new e.Internal.Callbacks(this.log,"receiptsVerified()",!0),this.errorCallbacks=new e.Internal.Callbacks(this.log,"error()"),this.initializedHasBeenCalled=!1,this.version=e.PLUGIN_VERSION;const t=this;this.listener=new e.Internal.StoreAdapterListener({updatedCallbacks:this.updatedCallbacks,updatedReceiptCallbacks:this.updatedReceiptsCallbacks,approvedCallbacks:this.approvedCallbacks,finishedCallbacks:this.finishedCallbacks,pendingCallbacks:this.pendingCallbacks,receiptsReadyCallbacks:this.receiptsReadyCallbacks},this.log),this.transactionStateMonitors=new e.Internal.TransactionStateMonitors(this.when()),this._validator=new e.Internal.Validator({adapters:this.adapters,getApplicationUsername:this.getApplicationUsername.bind(this),get localReceipts(){return t.localReceipts},get validator(){return t.validator},get validator_privacy_policy(){return t.validator_privacy_policy},verifiedCallbacks:this.verifiedCallbacks,unverifiedCallbacks:this.unverifiedCallbacks,finish:e=>this.finish(e)},this.log),new e.Internal.ReceiptsMonitor({hasLocalReceipts:()=>this.localReceipts.length>0,hasValidator:()=>!!this.validator,numValidationRequests:()=>this._validator.numRequests,numValidationResponses:()=>this._validator.numResponses,off:this.off.bind(this),when:this.when.bind(this),receiptsVerified:()=>{t.receiptsVerifiedCallbacks.trigger()},log:this.log}).launch()}getAdapter(e){return this.adapters.find(e)}getApplicationUsername(){return this.applicationUsername instanceof Function?this.applicationUsername():this.applicationUsername}register(e){this.registeredProducts.add(e)}async initialize(e=[this.defaultPlatform()]){if(this.initializedHasBeenCalled)return this.log.warn("store.initialized() has been called already."),[];this.log.info("initialize()"),this.initializedHasBeenCalled=!0;const t=this,i=this.adapters.initialize(e,{error:this.triggerError.bind(this),get verbosity(){return t.verbosity},getApplicationUsername(){return t.getApplicationUsername()},get listener(){return t.listener},get log(){return t.log},get registeredProducts(){return t.registeredProducts},apiDecorators:{canPurchase:this.canPurchase.bind(this),owned:this.owned.bind(this),finish:this.finish.bind(this),order:this.order.bind(this),verify:this.verify.bind(this)}});return i.then((()=>{this._readyCallbacks.trigger(),this.listener.setSupportedPlatforms(this.adapters.list.filter((e=>e.isSupported)).map((e=>e.id)))})),i}refresh(){throw new Error("use store.initialize() or store.update()")}async update(){var t;this.log.info("update()");for(const i of this.registeredProducts.byPlatform()){const r=await(null===(t=this.adapters.findReady(i.platform))||void 0===t?void 0:t.loadProducts(i.products));null===r||void 0===r||r.forEach((t=>{t instanceof e.Product&&this.updatedCallbacks.trigger(t)}))}}ready(e){this._readyCallbacks.add(e)}get isReady(){return this._readyCallbacks.isReady}when(){const e={productUpdated:t=>(this.updatedCallbacks.push(t),e),receiptUpdated:t=>(this.updatedReceiptsCallbacks.push(t),e),updated:t=>(this.updatedCallbacks.push(t),this.updatedReceiptsCallbacks.push(t),e),approved:t=>(this.approvedCallbacks.push(t),e),pending:t=>(this.pendingCallbacks.push(t),e),finished:t=>(this.finishedCallbacks.push(t),e),verified:t=>(this.verifiedCallbacks.push(t),e),unverified:t=>(this.unverifiedCallbacks.push(t),e),receiptsReady:t=>(this.receiptsReadyCallbacks.push(t),e),receiptsVerified:t=>(this.receiptsVerifiedCallbacks.push(t),e)};return e}off(e){this.updatedCallbacks.remove(e),this.updatedReceiptsCallbacks.remove(e),this.approvedCallbacks.remove(e),this.finishedCallbacks.remove(e),this.pendingCallbacks.remove(e),this.verifiedCallbacks.remove(e),this.unverifiedCallbacks.remove(e),this.receiptsReadyCallbacks.remove(e),this.receiptsVerifiedCallbacks.remove(e),this.errorCallbacks.remove(e),this._readyCallbacks.remove(e)}monitor(t,i){return this.transactionStateMonitors.start(t,e.Utils.safeCallback(this.log,"monitor()",i))}get products(){return[].concat(...this.adapters.list.map((e=>e.products)))}get(e,t){var i;return null===(i=this.adapters.findReady(t))||void 0===i?void 0:i.products.find((t=>t.id===e))}get localReceipts(){return[].concat(...this.adapters.list.map((e=>e.receipts)))}get localTransactions(){const e=[];for(const t of this.localReceipts)e.push(...t.transactions);return e}get verifiedReceipts(){return this._validator.verifiedReceipts}get verifiedPurchases(){return e.Internal.VerifiedReceipts.getVerifiedPurchases(this.verifiedReceipts)}findInVerifiedReceipts(t){return e.Internal.VerifiedReceipts.find(this.verifiedReceipts,t)}findInLocalReceipts(t){return e.Internal.LocalReceipts.find(this.localReceipts,t)}canPurchase(t){const i=t instanceof e.Offer?this.get(t.productId,t.platform):t,r=this.adapters.findReady(t.platform);return!!(null===r||void 0===r?void 0:r.checkSupport("order"))&&e.Internal.LocalReceipts.canPurchase(this.localReceipts,i)}owned(t){return e.Internal.owned({product:"string"===typeof t?{id:t}:t,verifiedReceipts:this.validator?this.verifiedReceipts:void 0,localReceipts:this.localReceipts})}async order(t,i){this.log.info(`order(${t.productId})`);const r=this.adapters.findReady(t.platform);if(!r)return e.storeError(e.ErrorCode.PAYMENT_NOT_ALLOWED,"Adapter not found or not ready ("+t.platform+")");const o=await r.order(t,i||{});return o&&"isError"in o&&e.store.triggerError(o),o}requestPayment(t,i){var r,o,n,s,a;const c=this.adapters.findReady(t.platform);if(!c)return e.PaymentRequestPromise.failed(e.ErrorCode.PAYMENT_NOT_ALLOWED,"Adapter not found or not ready ("+t.platform+")");if(!t.amountMicros){t.amountMicros=0;for(const e of t.items)t.amountMicros+=null!==(o=null===(r=null===e||void 0===e?void 0:e.pricing)||void 0===r?void 0:r.priceMicros)&&void 0!==o?o:0}if(t.currency)for(const d of t.items)if(null===(s=null===d||void 0===d?void 0:d.pricing)||void 0===s?void 0:s.currency){if(t.currency!==d.pricing.currency)return e.PaymentRequestPromise.failed(e.ErrorCode.PAYMENT_INVALID,"Currencies do not match")}else(null===d||void 0===d?void 0:d.pricing)&&(d.pricing.currency=t.currency);else for(const e of t.items)(null===(n=null===e||void 0===e?void 0:e.pricing)||void 0===n?void 0:n.currency)&&(t.currency=e.pricing.currency);if(1===t.items.length){const e=t.items[0];e&&!e.pricing&&(e.pricing={priceMicros:null!==(a=t.amountMicros)&&void 0!==a?a:0,currency:t.currency})}const l=new e.PaymentRequestPromise;return c.requestPayment(t,i).then((t=>{if(l.trigger(t),t instanceof e.Transaction){const i=i=>{l.trigger(t),t.state===e.TransactionState.FINISHED&&r.stop()},r=this.monitor(t,i)}})),l}checkSupport(e,t){const i=this.adapters.find(e);return!!i&&i.checkSupport(t)}async verify(e){this.log.info(`verify(${e.className})`),this._validator.add(e),setTimeout((()=>this._validator.run()),200)}async finish(t){this.log.info(`finish(${t.className})`);const i=t instanceof e.VerifiedReceipt?t.sourceReceipt.transactions:t instanceof e.Receipt?t.transactions:[t];i.forEach((e=>{var t;null===(t=this.adapters.findReady(e.platform))||void 0===t||t.finish(e)}))}async restorePurchases(){for(const e of this.adapters.list)e.ready&&await e.restorePurchases()}async manageSubscriptions(t){this.log.info("manageSubscriptions()");const i=this.adapters.findReady(t);return i?i.manageSubscriptions():e.storeError(e.ErrorCode.SETUP,"Found no adapter ready to handle 'manageSubscription'")}async manageBilling(t){this.log.info("manageBilling()");const i=this.adapters.findReady(t);return i?i.manageBilling():e.storeError(e.ErrorCode.SETUP,"Found no adapter ready to handle 'manageBilling'")}defaultPlatform(){switch(window.cordova.platformId){case"android":return e.Platform.GOOGLE_PLAY;case"ios":return e.Platform.APPLE_APPSTORE;default:return e.Platform.TEST}}error(e){this.errorCallbacks.push(e)}triggerError(e){this.errorCallbacks.trigger(e)}}e.Store=t}(e||(e={})),setTimeout((()=>{console.log("Create CdvPurchase..."),window.CdvPurchase=e,window.CdvPurchase.store=new e.Store,Object.assign(window.CdvPurchase.store,e.LogLevel,e.ProductType,e.ErrorCode,e.Platform)}),0),function(e){let t,i,r,o,n,s,a,c;(function(e){e["CONSUMABLE"]="consumable",e["NON_CONSUMABLE"]="non consumable",e["FREE_SUBSCRIPTION"]="free subscription",e["PAID_SUBSCRIPTION"]="paid subscription",e["NON_RENEWING_SUBSCRIPTION"]="non renewing subscription",e["APPLICATION"]="application"})(t=e.ProductType||(e.ProductType={})),function(e){e["NON_RECURRING"]="NON_RECURRING",e["FINITE_RECURRING"]="FINITE_RECURRING",e["INFINITE_RECURRING"]="INFINITE_RECURRING"}(i=e.RecurrenceMode||(e.RecurrenceMode={})),function(e){e["PAY_AS_YOU_GO"]="PayAsYouGo",e["UP_FRONT"]="UpFront",e["FREE_TRIAL"]="FreeTrial"}(r=e.PaymentMode||(e.PaymentMode={})),function(e){e["APPLE_APPSTORE"]="ios-appstore",e["GOOGLE_PLAY"]="android-playstore",e["WINDOWS_STORE"]="windows-store-transaction",e["BRAINTREE"]="braintree",e["TEST"]="test"}(o=e.Platform||(e.Platform={})),function(e){e["INITIATED"]="initiated",e["PENDING"]="pending",e["APPROVED"]="approved",e["CANCELLED"]="cancelled",e["FINISHED"]="finished",e["UNKNOWN_STATE"]=""}(n=e.TransactionState||(e.TransactionState={})),function(e){e["LAPSE"]="Lapse",e["RENEW"]="Renew"}(s=e.RenewalIntent||(e.RenewalIntent={})),function(e){e["NOTIFIED"]="Notified",e["AGREED"]="Agreed"}(a=e.PriceConsentStatus||(e.PriceConsentStatus={})),function(e){e["NOT_CANCELED"]="",e["DEVELOPER"]="Developer",e["SYSTEM"]="System",e["SYSTEM_REPLACED"]="System.Replaced",e["SYSTEM_PRODUCT_UNAVAILABLE"]="System.ProductUnavailable",e["SYSTEM_BILLING_ERROR"]="System.BillingError",e["SYSTEM_DELETED"]="System.Deleted",e["CUSTOMER"]="Customer",e["CUSTOMER_TECHNICAL_ISSUES"]="Customer.TechnicalIssues",e["CUSTOMER_PRICE_INCREASE"]="Customer.PriceIncrease",e["CUSTOMER_COST"]="Customer.Cost",e["CUSTOMER_FOUND_BETTER_APP"]="Customer.FoundBetterApp",e["CUSTOMER_NOT_USEFUL_ENOUGH"]="Customer.NotUsefulEnough",e["CUSTOMER_OTHER_REASON"]="Customer.OtherReason",e["UNKNOWN"]="Unknown"}(c=e.CancelationReason||(e.CancelationReason={}))}(e||(e={})),function(e){class t{constructor(e,t){this.className="Offer",this.id=e.id,this.pricingPhases=e.pricingPhases,Object.defineProperty(this,"productId",{enumerable:!0,get:()=>e.product.id}),Object.defineProperty(this,"productType",{enumerable:!0,get:()=>e.product.type}),Object.defineProperty(this,"productGroup",{enumerable:!0,get:()=>e.product.group}),Object.defineProperty(this,"platform",{enumerable:!0,get:()=>e.product.platform}),Object.defineProperty(this,"order",{enumerable:!1,get:()=>e=>t.order(this,e)}),Object.defineProperty(this,"canPurchase",{enumerable:!1,get:()=>t.canPurchase(this)})}get productId(){return""}get productType(){return e.ProductType.APPLICATION}get productGroup(){}get platform(){return e.Platform.TEST}async order(e){}get canPurchase(){return!1}}e.Offer=t}(e||(e={})),function(e){class t{constructor(){this.failedCallbacks=new e.Internal.PromiseLike,this.initiatedCallbacks=new e.Internal.PromiseLike,this.approvedCallbacks=new e.Internal.PromiseLike,this.finishedCallbacks=new e.Internal.PromiseLike,this.cancelledCallback=new e.Internal.PromiseLike}failed(e){return this.failedCallbacks.push(e),this}initiated(e){return this.initiatedCallbacks.push(e),this}approved(e){return this.approvedCallbacks.push(e),this}finished(e){return this.finishedCallbacks.push(e),this}cancelled(e){return this.cancelledCallback.push(e),this}trigger(t){if(t)if("isError"in t)this.failedCallbacks.resolve(t);else switch(t.state){case e.TransactionState.INITIATED:this.initiatedCallbacks.resolve(t);break;case e.TransactionState.APPROVED:this.approvedCallbacks.resolve(t);break;case e.TransactionState.FINISHED:this.finishedCallbacks.resolve(t);break}else this.cancelledCallback.resolve();return this}static failed(i,r){return(new t).trigger(e.storeError(i,r))}static cancelled(){return(new t).trigger()}static initiated(e){return(new t).trigger(e)}}e.PaymentRequestPromise=t}(e||(e={})),function(e){class t{constructor(e,t){this.className="Receipt",this.transactions=[],this.platform=e,Object.defineProperty(this,"verify",{enumerable:!1,get(){return()=>t.verify(this)}}),Object.defineProperty(this,"finish",{enumerable:!1,get(){return()=>t.finish(this)}})}async verify(){}async finish(){}hasTransaction(e){return!!this.transactions.find((t=>t===e))}lastTransaction(){return this.transactions[this.transactions.length-1]}}e.Receipt=t}(e||(e={})),function(e){class t{constructor(t,i,r){this.className="Transaction",this.transactionId="",this.state=e.TransactionState.UNKNOWN_STATE,this.products=[],this.platform=t,Object.defineProperty(this,"finish",{enumerable:!1,get(){return()=>r.finish(this)}}),Object.defineProperty(this,"verify",{enumerable:!1,get(){return()=>r.verify(this)}}),Object.defineProperty(this,"parentReceipt",{enumerable:!1,get(){return i}})}async finish(){}async verify(){}get parentReceipt(){return{}}}e.Transaction=t}(e||(e={})),function(e){let t;(function(t){class i{constructor(e,t){this.supportedPlatforms=[],this.platformWithReceiptsReady=[],this.lastTransactionState={},this.delegate=e,this.log=t.child("AdapterListener")}static makeTransactionToken(e){return e.platform+"|"+e.transactionId}setSupportedPlatforms(e){this.log.debug("setSupportedPlatforms: "+e.join(",")),this.supportedPlatforms=e,this.supportedPlatforms.length===this.platformWithReceiptsReady.length&&this.delegate.receiptsReadyCallbacks.trigger()}receiptsReady(e){this.supportedPlatforms.length>0&&this.platformWithReceiptsReady.length===this.supportedPlatforms.length||this.platformWithReceiptsReady.indexOf(e)<0&&(this.log.debug("receiptsReady: "+e),this.platformWithReceiptsReady.push(e),this.platformWithReceiptsReady.length===this.supportedPlatforms.length&&(this.log.debug("calling receiptsReady()"),this.delegate.receiptsReadyCallbacks.trigger()))}productsUpdated(e,t){t.forEach((e=>this.delegate.updatedCallbacks.trigger(e)))}receiptsUpdated(t,r){r.forEach((t=>{this.delegate.updatedReceiptCallbacks.trigger(t),t.transactions.forEach((t=>{const r=i.makeTransactionToken(t),o=this.lastTransactionState[r];t.state===e.TransactionState.APPROVED?this.delegate.approvedCallbacks.trigger(t):o!==t.state&&(t.state===e.TransactionState.FINISHED?this.delegate.finishedCallbacks.trigger(t):t.state===e.TransactionState.PENDING&&this.delegate.pendingCallbacks.trigger(t)),this.lastTransactionState[r]=t.state}))}))}}t.StoreAdapterListener=i})(t=e.Internal||(e.Internal={}))}(e||(e={})),function(e){let t;(function(e){class t{static find(e,t){var i,r;if(!t)return;let o;for(const n of e)if(!t.platform||n.platform===t.platform)for(const e of n.transactions)for(const n of e.products)n.id===t.id&&(!o||(null!==(i=e.purchaseDate)&&void 0!==i?i:0)<(null!==(r=o.purchaseDate)&&void 0!==r?r:1))&&(o=e);return o}static isOwned(e,i){if(!i)return!1;const r=t.find(e,i);return!!r&&(!r.isConsumed&&(!r.isPending&&(!r.expirationDate||r.expirationDate.getTime()>+new Date)))}static canPurchase(e,i){if(!i)return!1;const r=t.find(e,i);return!r||(!!r.isConsumed||(!r.expirationDate||r.expirationDate.getTime()<=+new Date))}}e.LocalReceipts=t})(t=e.Internal||(e.Internal={}))}(e||(e={})),function(e){let t;(function(e){function t(t){return void 0!==t.verifiedReceipts?e.VerifiedReceipts.isOwned(t.verifiedReceipts,t.product):void 0!==t.localReceipts&&e.LocalReceipts.isOwned(t.localReceipts,t.product)}e.owned=t})(t=e.Internal||(e.Internal={}))}(e||(e={})),function(e){let t;(function(e){class t{constructor(){this.resolved=!1,this.callbacks=[]}push(e){this.resolved?setTimeout(e,0,this.resolvedArgument):this.callbacks.push(e)}resolve(e){this.resolved||(this.resolved=!0,this.resolvedArgument=e,this.callbacks.forEach((t=>setTimeout(t,0,e))),this.callbacks=[])}}e.PromiseLike=t})(t=e.Internal||(e.Internal={}))}(e||(e={})),function(e){let t;(function(e){class t{constructor(e){this.hasCalledReceiptsVerified=!1,this.controller=e,this.log=e.log.child("ReceiptsMonitor")}callReceiptsVerified(){this.hasCalledReceiptsVerified||(this.hasCalledReceiptsVerified=!0,this.log.info("receiptsVerified()"),this.controller.when().receiptsReady((()=>{setTimeout((()=>{this.controller.receiptsVerified()}),0)})))}launch(){const e=()=>{this.log.debug(`check(${this.controller.numValidationResponses()}/${this.controller.numValidationRequests()})`),this.controller.numValidationRequests()===this.controller.numValidationResponses()&&(void 0!==this.intervalChecker&&(clearInterval(this.intervalChecker),this.intervalChecker=void 0),this.controller.off(e),this.callReceiptsVerified())};this.controller.when().verified(e).unverified(e).receiptsReady((()=>{this.log.debug("receiptsReady..."),this.controller.hasLocalReceipts()&&this.controller.hasValidator()||setTimeout((()=>{e()}),0),this.intervalChecker=setInterval((()=>{this.log.debug("keep checking every 10s..."),e()}),1e4)}))}}e.ReceiptsMonitor=t})(t=e.Internal||(e.Internal={}))}(e||(e={})),function(e){let t;(function(e){class t{constructor(){this.list=[]}find(e,t){return this.list.find((i=>i.platform===e&&i.id===t))}add(e){const t=Array.isArray(e)?e:[e],i=t.filter((e=>!this.find(e.platform,e.id)));for(const r of i)this.list.push(r)}byPlatform(){const e={};return this.list.forEach((t=>{e[t.platform]=(e[t.platform]||[]).concat(t)})),Object.keys(e).map((t=>({platform:t,products:e[t]})))}}e.RegisteredProducts=t})(t=e.Internal||(e.Internal={}))}(e||(e={})),function(e){let t;(function(e){class t{constructor(e=5e3,t=12e4){this.maxTimeout=12e4,this.minTimeout=5e3,this.retryTimeout=5e3,this.retries=[],this.minTimeout=e,this.maxTimeout=t,this.retryTimeout=e,document.addEventListener("online",(()=>{const e=this.retries;this.retries=[],this.retryTimeout=this.minTimeout;for(var t=0;t<e.length;++t)clearTimeout(e[t].tid),e[t].fn.call(this)}),!1)}retry(e){var t=setTimeout((()=>{this.retries=this.retries.filter((function(e){return t!==e.tid})),e()}),this.retryTimeout);this.retries.push({tid:t,fn:e}),this.retryTimeout*=2,this.retryTimeout>this.maxTimeout&&(this.retryTimeout=this.maxTimeout)}}e.Retry=t})(t=e.Internal||(e.Internal={}))}(e||(e={})),function(e){let t;(function(t){class i{constructor(e){this.monitors=[],e.approved((e=>this.callOnChange(e))).finished((e=>this.callOnChange(e)))}findMonitors(e){return this.monitors.filter((t=>t.transaction.platform===e.platform&&t.transaction.transactionId===e.transactionId))}callOnChange(e){this.findMonitors(e).forEach((t=>{t.lastChange!==e.state&&(t.lastChange=e.state,t.onChange(e.state))}))}start(t,i){const r=e.Utils.uuidv4();return this.monitors.push({monitorId:r,transaction:t,onChange:i,lastChange:t.state}),setTimeout(i,0,t.state),{transaction:t,stop:()=>this.stop(r)}}stop(e){this.monitors=this.monitors.filter((t=>t.monitorId!==e))}}t.TransactionStateMonitors=i})(t=e.Internal||(e.Internal={}))}(e||(e={})),function(e){let t;(function(e){class t{static find(e,t){var i,r;if(!t)return;let o;for(const n of e)if(!t.platform||n.platform===t.platform)for(const e of n.collection)e.id===t.id&&(null!==(i=null===o||void 0===o?void 0:o.purchaseDate)&&void 0!==i?i:0)<(null!==(r=e.purchaseDate)&&void 0!==r?r:1)&&(o=e);return o}static isOwned(e,i){if(!i)return!1;const r=t.find(e,i);return!!r&&(!(null===r||void 0===r?void 0:r.isExpired)&&(!(null===r||void 0===r?void 0:r.expiryDate)||r.expiryDate>+new Date))}static getVerifiedPurchases(e){var t,i,r,o;const n={};for(const s of e)for(const e of s.collection){const a=s.platform+":"+e.id,c=n[a];(!c||c&&(null!==(i=null!==(t=c.lastRenewalDate)&&void 0!==t?t:c.purchaseDate)&&void 0!==i?i:0)<(null!==(o=null!==(r=e.lastRenewalDate)&&void 0!==r?r:e.purchaseDate)&&void 0!==o?o:0))&&(n[a]=Object.assign(Object.assign({},e),{platform:s.platform}))}return Object.keys(n).map((e=>n[e]))}}e.VerifiedReceipts=t})(t=e.Internal||(e.Internal={}))}(e||(e={})),function(e){let t;(function(e){let t,i,r;(function(e){e["Name"]="name",e["EmailAddress"]="emailAddress",e["PhoneNumber"]="phoneNumber",e["PostalAddress"]="postalAddress",e["PhoneticName"]="phoneticName"})(t=e.ContactField||(e.ContactField={})),function(e){e["Amex"]="Amex",e["Barcode"]="Barcode",e["CartesBancaires"]="CartesBancaires",e["ChinaUnionPay"]="ChinaUnionPay",e["Dankort"]="Dankort",e["Discover"]="Discover",e["Eftpos"]="Eftpos",e["Electron"]="Electron",e["Elo"]="Elo",e["Girocard"]="Girocard",e["IDCredit"]="IDCredit",e["Interac"]="Interac",e["JCB"]="JCB",e["Mada"]="Mada",e["Maestro"]="Maestro",e["MasterCard"]="MasterCard",e["Mir"]="Mir",e["Nanaco"]="Nanaco",e["PrivateLabel"]="PrivateLabel",e["QuicPay"]="QuicPay",e["Suica"]="Suica",e["Visa"]="Visa",e["VPay"]="VPay",e["Waon"]="Waon"}(i=e.PaymentNetwork||(e.PaymentNetwork={})),function(e){e["ThreeDS"]="3DS",e["EMV"]="EMV",e["Credit"]="Credit",e["Debit"]="Debit"}(r=e.MerchantCapability||(e.MerchantCapability={}))})(t=e.ApplePay||(e.ApplePay={}))}(e||(e={})),function(e){let t;(function(t){function i(e){return`virtual.${e}`}class r{constructor(i,r){var o,n;this.id=e.Platform.APPLE_APPSTORE,this.name="AppStore",this.ready=!1,this._canMakePayments=!1,this.forceReceiptReload=!1,this._products=[],this.validProducts={},this._paymentMonitor=()=>{},this._appStoreReceiptLoading=!1,this._appStoreReceiptCallbacks=[],this.context=i,this.bridge=new t.Bridge.Bridge,this.log=i.log.child("AppleAppStore"),this.discountEligibilityDeterminer=r.discountEligibilityDeterminer,this.needAppReceipt=null===(o=r.needAppReceipt)||void 0===o||o,this.autoFinish=null!==(n=r.autoFinish)&&void 0!==n&&n,this.pseudoReceipt=new e.Receipt(e.Platform.APPLE_APPSTORE,this.context.apiDecorators),this.receiptsUpdated=e.Utils.debounce((()=>{this._receiptsUpdated()}),300)}get products(){return this._products}getProduct(e){return this._products.find((t=>t.id===e))}get receipts(){return(this._receipt?[this._receipt]:[]).concat(this.pseudoReceipt?this.pseudoReceipt:[])}addValidProducts(e,t){t.forEach((t=>{const i=e.find((e=>e.id===t.id));i&&(this.validProducts[t.id]=Object.assign(Object.assign({},t),i))}))}get isSupported(){return"ios"===window.cordova.platformId}upsertTransactionInProgress(r,o){const n=i(r);return new Promise((i=>{const s=this.pseudoReceipt.transactions.find((e=>e.transactionId===n));if(s)s.state=o,s.refresh(r),i(s);else{const s=new t.SKTransaction(e.Platform.APPLE_APPSTORE,this.pseudoReceipt,this.context.apiDecorators);s.state=o,s.transactionId=n,s.refresh(r),this.pseudoReceipt.transactions.push(s),i(s)}}))}removeTransactionInProgress(e){const t=i(e);this.pseudoReceipt.transactions=this.pseudoReceipt.transactions.filter((e=>e.transactionId!==t))}async upsertTransaction(i,r,o){return new Promise((n=>{this.initializeAppReceipt((()=>{var s;if(!this._receipt)return void this.log.warn("Failed to load the application receipt, cannot proceed with handling the purchase");const a=null===(s=this._receipt)||void 0===s?void 0:s.transactions.find((e=>e.transactionId===r));if(a)a.state=o,a.refresh(i),n(a);else{const s=new t.SKTransaction(e.Platform.APPLE_APPSTORE,this._receipt,this.context.apiDecorators);s.state=o,s.transactionId=r,s.refresh(i),this._receipt.transactions.push(s),n(s)}}))}))}removeTransaction(e){this._receipt&&(this._receipt.transactions=this._receipt.transactions.filter((t=>t.transactionId!==e)))}_receiptsUpdated(){this._receipt?(this.context.listener.receiptsUpdated(e.Platform.APPLE_APPSTORE,[this._receipt,this.pseudoReceipt]),this.context.listener.receiptsReady(e.Platform.APPLE_APPSTORE)):this.context.listener.receiptsUpdated(e.Platform.APPLE_APPSTORE,[this.pseudoReceipt])}setPaymentMonitor(e){this._paymentMonitor=e}callPaymentMonitor(e,t,i){this._paymentMonitor(e)}initialize(){return new Promise((t=>{this.log.info("bridge.init");const i=this.log.child("Bridge");this.bridge.init({autoFinish:this.autoFinish,debug:this.context.verbosity===e.LogLevel.DEBUG,log:e=>i.debug(e),error:(t,i,r)=>{this.log.error("ERROR: "+t+" - "+i),t!==e.ErrorCode.PAYMENT_CANCELLED?this.context.error(e.storeError(t,i)):this.callPaymentMonitor("cancelled",e.ErrorCode.PAYMENT_CANCELLED,i)},ready:()=>{this.log.info("ready")},purchased:async(t,i,r,o,n)=>{this.log.info("purchase: id:"+t+" product:"+i+" originalTransaction:"+r+" - date:"+o+" - discount:"+n);const s=await this.upsertTransaction(i,t,e.TransactionState.APPROVED);s.refresh(i,r,o,n),this.removeTransactionInProgress(i),this.receiptsUpdated(),this.callPaymentMonitor("purchased")},purchaseEnqueued:async(t,i)=>{this.log.info("purchaseEnqueued: "+t+" - "+i),await this.upsertTransactionInProgress(t,e.TransactionState.INITIATED),this.context.listener.receiptsUpdated(e.Platform.APPLE_APPSTORE,[this.pseudoReceipt])},purchaseFailed:(t,i,r)=>{this.log.info("purchaseFailed: "+t+" - "+i+" - "+r),this.removeTransactionInProgress(t),this.context.listener.receiptsUpdated(e.Platform.APPLE_APPSTORE,[this.pseudoReceipt]),this.callPaymentMonitor("failed",i,r)},purchasing:async t=>{this.log.info("purchasing: "+t),await this.upsertTransactionInProgress(t,e.TransactionState.INITIATED),this.context.listener.receiptsUpdated(e.Platform.APPLE_APPSTORE,[this.pseudoReceipt])},deferred:async t=>{this.log.info("deferred: "+t),await this.upsertTransactionInProgress(t,e.TransactionState.PENDING),this.context.listener.receiptsUpdated(e.Platform.APPLE_APPSTORE,[this.pseudoReceipt]),this.callPaymentMonitor("deferred")},finished:async(t,i)=>{this.log.info("finish: "+t+" - "+i),this.removeTransactionInProgress(i),await this.upsertTransaction(i,t,e.TransactionState.FINISHED),this.receiptsUpdated()},restored:async(t,i)=>{this.log.info("restore: "+t+" - "+i),await this.upsertTransaction(i,t,e.TransactionState.APPROVED),this.receiptsUpdated()},receiptsRefreshed:e=>{this.log.info("receiptsRefreshed"),this._receipt&&this._receipt.refresh(e,this.needAppReceipt,this.context.apiDecorators)},restoreFailed:e=>{this.log.info("restoreFailed: "+e)},restoreCompleted:()=>{this.log.info("restoreCompleted")}},(async()=>{this.log.info("bridge.init done"),await this.canMakePayments(),t(void 0)}),((i,r)=>{this.log.info("bridge.init failed: "+i+" - "+r),t(e.storeError(i,r))}))}))}loadReceipts(){return new Promise((e=>{setTimeout((()=>{this.initializeAppReceipt((()=>{this.receiptsUpdated(),this._receipt?e([this._receipt,this.pseudoReceipt]):e([this.pseudoReceipt])}))}),300)}))}async canMakePayments(){return new Promise((e=>{this.bridge.canMakePayments((()=>{this._canMakePayments=!0,e(!0)}),(t=>{this.log.warn(`canMakePayments: ${t}`),this._canMakePayments=!1,e(!1)}))}))}async initializeAppReceipt(i){if(this._receipt)return this.log.debug("initializeAppReceipt() => already initialized."),i(void 0);if(this._appStoreReceiptCallbacks.push(i),this._appStoreReceiptLoading)return void this.log.debug("initializeAppReceipt() => already loading.");this._appStoreReceiptLoading=!0;const r=await this.loadAppStoreReceipt(),o=e=>{const t=this._appStoreReceiptCallbacks;this._appStoreReceiptCallbacks=[],t.forEach((t=>{t(e)}))};if(!(null===r||void 0===r?void 0:r.appStoreReceipt))return this.log.warn("no appStoreReceipt"),this._appStoreReceiptLoading=!1,void o(e.storeError(e.ErrorCode.REFRESH,"No appStoreReceipt"));this._receipt=new t.SKApplicationReceipt(r,this.needAppReceipt,this.context.apiDecorators),o(void 0)}prepareReceipt(e){(null===e||void 0===e?void 0:e.appStoreReceipt)&&(this._receipt?this._receipt.refresh(e,this.needAppReceipt,this.context.apiDecorators):this._receipt=new t.SKApplicationReceipt(e,this.needAppReceipt,this.context.apiDecorators))}async loadAppStoreReceipt(){let t=!1;return new Promise((e=>{var i;if(null===(i=this.bridge.appStoreReceipt)||void 0===i?void 0:i.appStoreReceipt)return this.log.debug("using cached appstore receipt"),e(this.bridge.appStoreReceipt);this.log.debug("loading appstore receipt..."),this.bridge.loadReceipts((i=>{this.log.debug("appstore receipt loaded"),t||e(i),t=!0}),((i,r)=>{this.log.warn("Failed to load appStoreReceipt: "+i+" - "+r),t||e(void 0),t=!0})),setTimeout((function(){t||e(void 0),t=!0}),5e3)})).then((t=>(this.context.listener.receiptsReady(e.Platform.APPLE_APPSTORE),t))).catch((t=>(this.context.listener.receiptsReady(e.Platform.APPLE_APPSTORE),t)))}async loadEligibility(e){if(!this.discountEligibilityDeterminer)return new t.Internal.DiscountEligibilities([],[]);const i=[];if(e.forEach((e=>{var t;null===(t=e.discounts)||void 0===t||t.forEach((t=>{i.push({productId:e.id,discountId:t.id,discountType:t.type})}))})),i.length>0){const e=await this.loadAppStoreReceipt();if(e&&e.appStoreReceipt){this.log.debug("calling discount eligibility determiner.");const r=await this.callDiscountEligibilityDeterminer(e,i);return this.log.debug("response: "+JSON.stringify(r)),new t.Internal.DiscountEligibilities(i,r)}return this.log.debug("no receipt, assuming introductory price are available."),new t.Internal.DiscountEligibilities(i,i.map((e=>"Introductory"===e.discountType)))}return new t.Internal.DiscountEligibilities([],[])}callDiscountEligibilityDeterminer(e,t){return new Promise((i=>{if(!this.discountEligibilityDeterminer)return i([]);this.discountEligibilityDeterminer(e,t,i)}))}loadProducts(i){return new Promise((r=>{this.log.info("bridge.load"),this.bridge.load(i.map((e=>e.id)),(async(o,n)=>{this.log.info("bridge.loaded: "+JSON.stringify({validProducts:o,invalidProducts:n})),this.addValidProducts(i,o);const s=await this.loadEligibility(o);this.log.info("eligibilities ready.");const a=i.map((i=>{if(n.indexOf(i.id)>=0)return this.log.debug(`${i.id} is invalid`),e.storeError(e.ErrorCode.INVALID_PRODUCT_ID,"Product not found in AppStore. #400");{const r=o.find((e=>e.id===i.id));if(this.log.debug(`${i.id} is valid: ${JSON.stringify(r)}`),!r)return e.storeError(e.ErrorCode.INVALID_PRODUCT_ID,"Product not found in AppStore. #404");let n=this.getProduct(i.id);return n?(this.log.debug("refreshing existing product"),null===n||void 0===n||n.refresh(r,this.context.apiDecorators,s)):(this.log.debug("registering existing product"),n=new t.SKProduct(r,i,this.context.apiDecorators,s),this._products.push(n)),n}}));this.log.debug(`Products loaded: ${JSON.stringify(a)}`),r(a)}),((t,r)=>i.map((i=>e.storeError(t,r)))))}))}async order(i,r){let o=!1;return new Promise((n=>{var s;const a=e=>{o||(this.setPaymentMonitor((()=>{})),o=!0,n(e))};this.log.info("order");const c=i.id!==t.DEFAULT_OFFER_ID?i.id:void 0,l=null===(s=null===r||void 0===r?void 0:r.appStore)||void 0===s?void 0:s.discount;if(c&&!l)return a(e.storeError(e.ErrorCode.MISSING_OFFER_PARAMS,"Missing additionalData.appStore.discount when ordering a discount offer"));if(c&&(null===l||void 0===l?void 0:l.id)!==c)return a(e.storeError(e.ErrorCode.INVALID_OFFER_IDENTIFIER,"Offer identifier does not match additionalData.appStore.discount.id"));this.setPaymentMonitor(((t,i,r)=>{if(this.log.info("order.paymentMonitor => "+t+" "+(null!==i&&void 0!==i?i:"")+" "+(null!==r&&void 0!==r?r:"")),!o)switch(t){case"cancelled":a(e.storeError(null!==i&&void 0!==i?i:e.ErrorCode.PAYMENT_CANCELLED,null!==r&&void 0!==r?r:"The user cancelled the order."));break;case"failed":setTimeout((()=>{a(e.storeError(null!==i&&void 0!==i?i:e.ErrorCode.PURCHASE,null!==r&&void 0!==r?r:"Purchase failed"))}),500);break;case"purchased":case"deferred":a(void 0);break}}));const d=()=>{this.log.info("order.success")},u=()=>{this.log.info("order.error"),a(e.storeError(e.ErrorCode.PURCHASE,"Failed to place order"))};this.forceReceiptReload=!0,this.bridge.purchase(i.productId,1,this.context.getApplicationUsername(),l,d,u)}))}finish(r){return new Promise((o=>{if(this.log.info("finish("+r.transactionId+")"),r.transactionId===t.APPLICATION_VIRTUAL_TRANSACTION_ID||r.transactionId===i(r.products[0].id))return r.state=e.TransactionState.FINISHED,this.context.listener.receiptsUpdated(e.Platform.APPLE_APPSTORE,[r.parentReceipt]),o(void 0);const n=()=>{r.state=e.TransactionState.FINISHED,this.context.listener.receiptsUpdated(e.Platform.APPLE_APPSTORE,[r.parentReceipt]),o(void 0)},s=t=>{(null===t||void 0===t?void 0:t.includes("[#CdvPurchase:100]"))?n():o(e.storeError(e.ErrorCode.FINISH,"Failed to finish transaction"))};this.bridge.finish(r.transactionId,n,s)}))}refreshReceipt(){return new Promise((t=>{const i=e=>{t(e)},r=(i,r)=>{t(e.storeError(i,r))};this.bridge.refreshReceipts(i,r)}))}async receiptValidationBody(i){if(i.platform!==e.Platform.APPLE_APPSTORE)return;if(i!==this._receipt)return;const r=i;let o=r.nativeData;if(this.forceReceiptReload){this.forceReceiptReload=!1;const e=await this.loadAppStoreReceipt();e&&(o=e,this.prepareReceipt(e))}if(!r.nativeData.appStoreReceipt){this.log.info("Cannot prepare the receipt validation body, because appStoreReceipt is missing. Refreshing...");const e=await this.refreshReceipt();if(!e||"isError"in e)return this.log.warn("Failed to refresh receipt, cannot run receipt validation."),void(e&&this.log.error(e));this.log.info("Receipt refreshed."),o=e}const n=r.transactions.slice(-1)[0];return{id:o.bundleIdentifier,type:e.ProductType.APPLICATION,products:Object.values(this.validProducts).map((e=>new t.SKProduct(e,e,this.context.apiDecorators,{isEligible:()=>!0}))),transaction:{type:"ios-appstore",id:null===n||void 0===n?void 0:n.transactionId,appStoreReceipt:o.appStoreReceipt}}}async handleReceiptValidationResponse(i,r){var o,n;let s=!1;if(r.ok){const e=null===(o=r.data)||void 0===o?void 0:o.transaction;"ios-appstore"===(null===e||void 0===e?void 0:e.type)&&"original_application_version"in e&&(null===(n=this._receipt)||void 0===n||n.transactions.forEach((i=>{i.transactionId===t.APPLICATION_VIRTUAL_TRANSACTION_ID&&e.original_purchase_date_ms&&(i.purchaseDate=new Date(parseInt(e.original_purchase_date_ms)),s=!0)})))}s&&this.context.listener.receiptsUpdated(e.Platform.APPLE_APPSTORE,[i])}async requestPayment(t,i){return e.storeError(e.ErrorCode.UNKNOWN,"requestPayment not supported")}async manageSubscriptions(){this.bridge.manageSubscriptions()}async manageBilling(){this.bridge.manageBilling()}checkSupport(e){if("order"===e)return this._canMakePayments;const t=["order","manageBilling","manageSubscriptions"];return t.indexOf(e)>=0}restorePurchases(){return new Promise((e=>{this.forceReceiptReload=!0,this.bridge.restore(),this.bridge.refreshReceipts((t=>{e()}),((t,i)=>{e()}))}))}presentCodeRedemptionSheet(){return new Promise((e=>{this.bridge.presentCodeRedemptionSheet(e)}))}}t.Adapter=r})(t=e.AppleAppStore||(e.AppleAppStore={}))}(e||(e={})),function(e){let t;(function(t){let i;(function(t){const i=e=>{};let r=i;function o(e,t,i,r){window.cordova.exec(i,r,"InAppPurchase",e,t)}function n(e,t,...i){if(e)try{e.apply(this,i)}catch(o){r("exception in "+t+': "'+o+'"')}}class s{constructor(){this.transactionsForProduct={},this.initialized=!1,this.registeredProducts=[],this.needRestoreNotification=!1,this.pendingUpdates=[],this.onPurchased=!1,this.onFailed=!1,this.onRestored=!1,window.storekit=this,this.options={error:i,ready:i,purchased:i,purchaseEnqueued:i,purchasing:i,purchaseFailed:i,deferred:i,finished:i,restored:i,receiptsRefreshed:i,restoreFailed:i,restoreCompleted:i}}init(t,s,a){this.options={error:t.error||i,ready:t.ready||i,purchased:t.purchased||i,purchaseEnqueued:t.purchaseEnqueued||i,purchasing:t.purchasing||i,purchaseFailed:t.purchaseFailed||i,deferred:t.deferred||i,finished:t.finished||i,restored:t.restored||i,receiptsRefreshed:t.receiptsRefreshed||i,restoreFailed:t.restoreFailed||i,restoreCompleted:t.restoreCompleted||i},t.debug&&(o("debug",[],i,i),r=t.log||function(e){console.log("[CdvPurchase.AppAppStore.Bridge] "+e)}),t.autoFinish&&o("autoFinish",[],i,i);const c=()=>{r("setup ok"),n(this.options.ready,"options.ready"),n(s,"init.success"),this.initialized=!0,setTimeout((()=>this.processPendingTransactions()),50)},l=()=>{r("setup failed"),n(a,"init.error",e.ErrorCode.SETUP,"Setup failed")};o("setup",[],c,l)}processPendingTransactions(){r("processing pending transactions"),o("processPendingTransactions",[],(()=>{this.finalizeTransactionUpdates()}),void 0)}purchase(t,i,s,a,c,l){i=0|i||1;const d=this.options;if(this.registeredProducts.indexOf(t)<0){const o="Purchasing "+t+" failed.  Ensure the product was loaded first with Bridge.load(...)!";return r(o),void("function"===typeof d.error&&n(d.error,"options.error",e.ErrorCode.PURCHASE,"Trying to purchase a unknown product.",{productId:t,quantity:i}))}const u=()=>{r("Purchase enqueued "+t),"function"===typeof d.purchaseEnqueued&&n(d.purchaseEnqueued,"options.purchaseEnqueued",t,i),n(c,"purchase.success")},p=()=>{const o="Purchase failed: "+t;r(o),"function"===typeof d.error&&n(d.error,"options.error",e.ErrorCode.PURCHASE,o,{productId:t,quantity:i}),n(l,"purchase.error")};o("purchase",[t,i,s,a||{}],u,p)}canMakePayments(e,t){return o("canMakePayments",[],e,t)}restore(e){this.needRestoreNotification=!0,o("restoreCompletedTransactions",[],e,e)}manageSubscriptions(e){o("manageSubscriptions",[],e,e)}manageBilling(e){o("manageBilling",[],e,e)}presentCodeRedemptionSheet(e){o("presentCodeRedemptionSheet",[],e,e)}load(t,i,s){const a=this.options;if("string"===typeof t&&(t=[t]),t)if(t.length){if("string"!==typeof t[0]){const i="invalid productIds given to store.load: "+JSON.stringify(t);return r(i),n(a.error,"options.error",e.ErrorCode.LOAD,i),void n(s,"load.error",e.ErrorCode.LOAD,i)}r("load "+JSON.stringify(t));const c=e=>{const t=e[0],o=e[1];r("load ok: { valid:"+JSON.stringify(t)+" invalid:"+JSON.stringify(o)+" }"),n(i,"load.success",t,o)},l=t=>{r("load failed"),r(t);const i="Load failed: "+t;n(a.error,"options.error",e.ErrorCode.LOAD,i),n(s,"load.error",e.ErrorCode.LOAD,i)};this.registeredProducts=this.registeredProducts.concat(t),o("load",[t],c,l)}else n(i,"load.success",[],[]);else n(i,"load.success",[],[])}finish(e,t,i){o("finishTransaction",[e],t,i)}finalizeTransactionUpdates(){for(let e=0;e<this.pendingUpdates.length;++e){const t=this.pendingUpdates[e];this.transactionUpdated(t.state,t.errorCode,t.errorText,t.transactionIdentifier,t.productId,t.transactionReceipt,t.originalTransactionIdentifier,t.transactionDate,t.discountId)}this.pendingUpdates=[]}lastTransactionUpdated(){}transactionUpdated(t,i,o,s,a,c,l,d,u){if(this.initialized)switch(r("transaction updated:"+s+" state:"+t+" product:"+a),a&&s&&(this.transactionsForProduct[a]?this.transactionsForProduct[a].push(s):this.transactionsForProduct[a]=[s]),t){case"PaymentTransactionStatePurchasing":return void n(this.options.purchasing,"options.purchasing",a);case"PaymentTransactionStatePurchased":return void n(this.options.purchased,"options.purchase",s,a,l,d,u);case"PaymentTransactionStateDeferred":return void n(this.options.deferred,"options.deferred",a);case"PaymentTransactionStateFailed":return n(this.options.purchaseFailed,"options.purchaseFailed",a,i||e.ErrorCode.UNKNOWN,o||"ERROR"),void n(this.options.error,"options.error",i||e.ErrorCode.UNKNOWN,o||"ERROR",{productId:a});case"PaymentTransactionStateRestored":return void n(this.options.restored,"options.restore",s,a);case"PaymentTransactionStateFinished":return void n(this.options.finished,"options.finish",s,a)}else this.pendingUpdates.push({state:t,errorCode:i,errorText:o,transactionIdentifier:s,productId:a,transactionReceipt:c,originalTransactionIdentifier:l,transactionDate:d,discountId:u})}restoreCompletedTransactionsFinished(){this.needRestoreNotification&&(this.needRestoreNotification=!1,n(this.options.restoreCompleted,"options.restoreCompleted"))}restoreCompletedTransactionsFailed(e){this.needRestoreNotification&&(this.needRestoreNotification=!1,n(this.options.restoreFailed,"options.restoreFailed",e))}parseReceiptArgs(e){const t=e[0],i=e[1],o=e[2],n=e[3],s=e[4];return r("infoPlist: "+i+","+o+","+n+","+s),{appStoreReceipt:t,bundleIdentifier:i,bundleShortVersion:o,bundleNumericVersion:n,bundleSignature:s}}refreshReceipts(t,i){const s=e=>{const i=this.parseReceiptArgs(e);this.appStoreReceipt=i,n(this.options.receiptsRefreshed,"options.receiptsRefreshed",i),n(t,"refreshReceipts.success",i)},a=t=>{r("refresh receipt failed: "+t),t.includes("(@AMSErrorDomain:100)")&&r('authentication failed, indicated by the string "(@AMSErrorDomain:100)"'),n(this.options.error,"options.error",e.ErrorCode.REFRESH_RECEIPTS,"Failed to refresh receipt: "+t),n(i,"refreshReceipts.error",e.ErrorCode.REFRESH_RECEIPTS,"Failed to refresh receipt: "+t)};this.appStoreReceipt=null,r("refreshing appStoreReceipt"),o("appStoreRefreshReceipt",[],s,a)}loadReceipts(e,t){const i=t=>{const i=this.parseReceiptArgs(t);this.appStoreReceipt=i,n(e,"loadReceipts.callback",i)},s=e=>{};r("loading appStoreReceipt"),o("appStoreReceipt",[],i,s)}}t.Bridge=s})(i=t.Bridge||(t.Bridge={}))})(t=e.AppleAppStore||(e.AppleAppStore={}))}(e||(e={})),function(e){let t;(function(e){let t;(function(e){class t{constructor(e,t){this.request=e,this.response=t}isEligible(e,t,i){var r;for(let o=0;o<this.request.length;++o){const n=this.request[o];if(n.productId===e&&n.discountId===i&&n.discountType===t)return null!==(r=this.response[o])&&void 0!==r&&r}return!1}}e.DiscountEligibilities=t})(t=e.Internal||(e.Internal={}))})(t=e.AppleAppStore||(e.AppleAppStore={}))}(e||(e={})),function(e){let t;(function(t){t.DEFAULT_OFFER_ID="$";class i extends e.Offer{constructor(e,t){super(e,t),this.offerType=e.offerType}}t.SKOffer=i;class r extends e.Product{constructor(e,t,i,r){super(t,i),this.raw=e,this.refresh(e,i,r)}removeIneligibleDiscounts(e){this.offers=this.offers.filter((t=>{const i=t;return"Default"===i.offerType||e.isEligible(this.id,i.offerType,t.id)}))}refresh(r,o,n){var s;this.raw=r,this.title=r.title,this.description=r.description,this.countryCode=r.countryCode,r.group&&(this.group=r.group),this.removeIneligibleDiscounts(n);const a={price:r.price,priceMicros:r.priceMicros,currency:r.currency,billingPeriod:l(r.billingPeriod,r.billingPeriodUnit),paymentMode:this.type===e.ProductType.PAID_SUBSCRIPTION?e.PaymentMode.PAY_AS_YOU_GO:e.PaymentMode.UP_FRONT,recurrenceMode:this.type===e.ProductType.PAID_SUBSCRIPTION?e.RecurrenceMode.INFINITE_RECURRING:e.RecurrenceMode.NON_RECURRING};function c(e){return e.offers.filter((e=>"Introductory"===e.offerType)).length>0}function l(e,t){return e&&t?`P${e}${t[0]}`:void 0}null===(s=r.discounts)||void 0===s||s.forEach((t=>{if(n.isEligible(r.id,t.type,t.id)){const n=[],s=t.paymentMode===e.PaymentMode.PAY_AS_YOU_GO?t.period:1,c=t.paymentMode===e.PaymentMode.PAY_AS_YOU_GO?1:t.period,d={price:t.price,priceMicros:t.priceMicros,currency:r.currency,billingPeriod:l(c,t.periodUnit),billingCycles:s,paymentMode:t.paymentMode,recurrenceMode:e.RecurrenceMode.FINITE_RECURRING};n.push(d),n.push(a),this.addOffer(new i({id:t.id,product:this,pricingPhases:n,offerType:t.type},o))}})),c(this)||this.addOffer(new i({id:t.DEFAULT_OFFER_ID,product:this,pricingPhases:[a],offerType:"Default"},o))}}t.SKProduct=r})(t=e.AppleAppStore||(e.AppleAppStore={}))}(e||(e={})),function(e){let t;(function(t){t.APPLICATION_VIRTUAL_TRANSACTION_ID="appstore.application";class i extends e.Receipt{constructor(t,i,r){super(e.Platform.APPLE_APPSTORE,r),this.nativeData=t,this.refresh(this.nativeData,i,r)}refresh(i,r,o){if(this.nativeData=i,r){const r=this.transactions.find((e=>e.transactionId===t.APPLICATION_VIRTUAL_TRANSACTION_ID));if(r)return;const n=new e.Transaction(e.Platform.APPLE_APPSTORE,this,o);n.transactionId=t.APPLICATION_VIRTUAL_TRANSACTION_ID,n.state=e.TransactionState.APPROVED,n.products.push({id:i.bundleIdentifier}),this.transactions.push(n)}}}t.SKApplicationReceipt=i;class r extends e.Transaction{refresh(e,t,i,r){e&&(this.products=[{id:e,offerId:r}]),t&&(this.originalTransactionId=t),i&&(this.purchaseDate=new Date(+i))}}t.SKTransaction=r})(t=e.AppleAppStore||(e.AppleAppStore={}))}(e||(e={})),function(e){let t;(function(e){let t;(function(e){let t;(function(e){e["CANCELED"]="1",e["BILLING_ERROR"]="2",e["PRICE_INCREASE"]="3",e["PRODUCT_NOT_AVAILABLE"]="4",e["UNKNOWN"]="5"})(t=e.AppleExpirationIntent||(e.AppleExpirationIntent={}))})(t=e.VerifyReceipt||(e.VerifyReceipt={}))})(t=e.AppleAppStore||(e.AppleAppStore={}))}(e||(e={})),function(e){let t;(function(t){class i extends e.Receipt{constructor(t,i,r){var o,n,s;super(e.Platform.BRAINTREE,r);const a=new e.Transaction(e.Platform.BRAINTREE,this,r);a.purchaseDate=new Date,a.products=(null===(o=t.items)||void 0===o?void 0:o.filter((e=>e)).map((e=>({id:(null===e||void 0===e?void 0:e.id)||""}))))||[],a.state=e.TransactionState.APPROVED,a.transactionId=null!==(s=null===(n=i.paymentMethodNonce)||void 0===n?void 0:n.nonce)&&void 0!==s?s:`UNKNOWN_${i.paymentMethodType}_${i.paymentDescription}`,this.transactions=[a],this.dropInResult=i,this.paymentRequest=t,this.refresh(t,i,r)}refresh(t,i,r){var o,n;this.dropInResult=i,this.paymentRequest=t;const s=new e.Transaction(e.Platform.BRAINTREE,this,r);s.products=t.items.filter((e=>e)).map((e=>({id:(null===e||void 0===e?void 0:e.id)||""}))),s.state=e.TransactionState.APPROVED,s.transactionId=null!==(n=null===(o=i.paymentMethodNonce)||void 0===o?void 0:o.nonce)&&void 0!==n?n:`UNKNOWN_${i.paymentMethodType}_${i.paymentDescription}`,s.amountMicros=t.amountMicros,s.currency=t.currency,this.transactions=[s]}}t.BraintreeReceipt=i;class r{constructor(t,i){this.id=e.Platform.BRAINTREE,this.name="BrainTree",this.ready=!1,this.products=[],this._receipts=[],this.context=t,this.log=t.log.child("Braintree"),this.options=i}get receipts(){return this._receipts}get isSupported(){return t.IosBridge.Bridge.isSupported()||t.AndroidBridge.Bridge.isSupported()}initialize(){return new Promise((i=>{if(this.log.info("initialize()"),t.IosBridge.Bridge.isSupported())this.log.info("instantiating ios bridge..."),this.iosBridge=new t.IosBridge.Bridge(this.log,(t=>{this.options.tokenizationKey?t(this.options.tokenizationKey):this.options.clientTokenProvider?this.options.clientTokenProvider(t):t(e.storeError(e.ErrorCode.CLIENT_INVALID,"Braintree iOS Bridge requires a clientTokenProvider or tokenizationKey"))}),this.options.applePay),this.iosBridge.initialize(this.context,i);else if(t.AndroidBridge.Bridge.isSupported()&&!this.androidBridge){this.log.info("instantiating android bridge..."),this.androidBridge=new t.AndroidBridge.Bridge(this.log),this.log.info("calling android bridge -> initialize...");const e=this.options.tokenizationKey?this.options.tokenizationKey:this.options.clientTokenProvider?this.options.clientTokenProvider:"";this.androidBridge.initialize(e,i)}else this.log.info("platform not supported..."),i(void 0);this.context.listener.receiptsReady(e.Platform.BRAINTREE)}))}async loadProducts(t){return t.map((t=>e.storeError(e.ErrorCode.PRODUCT_NOT_AVAILABLE,"N/A")))}async loadReceipts(){return this.context.listener.receiptsReady(e.Platform.BRAINTREE),[]}async order(t){return e.storeError(e.ErrorCode.UNKNOWN,"N/A: Not implemented with Braintree")}async finish(t){t.state=e.TransactionState.FINISHED,this.context.listener.receiptsUpdated(e.Platform.TEST,[t.parentReceipt])}async manageSubscriptions(){this.log.info("N/A: manageSubscriptions() is not available with Braintree")}async manageBilling(){this.log.info("N/A: manageBilling() is not available with Braintree")}async launchDropIn(t,i){return this.androidBridge?this.androidBridge.launchDropIn(i):this.iosBridge?this.iosBridge.launchDropIn(t,i):e.storeError(e.ErrorCode.PURCHASE,"Braintree is not available")}async requestPayment(r,n){var c,l,d,u,p,h,f,g,m;this.log.info("requestPayment()"+JSON.stringify(r));const P=(null===(c=null===n||void 0===n?void 0:n.braintree)||void 0===c?void 0:c.dropInRequest)||{};if(await t.IosBridge.ApplePayPlugin.isSupported(this.log)||(this.log.info("Apple Pay is not supported."),P.applePayDisabled=!0),this.options.googlePay||P.googlePayRequest){const e=Object.assign(Object.assign({},null!==(l=this.options.googlePay)&&void 0!==l?l:{}),null!==(d=P.googlePayRequest)&&void 0!==d?d:{});e.transactionInfo||(e.transactionInfo={currencyCode:null!==(u=r.currency)&&void 0!==u?u:"",totalPrice:(null!==(p=r.amountMicros)&&void 0!==p?p:0)/1e6,totalPriceStatus:t.GooglePay.TotalPriceStatus.FINAL}),P.googlePayRequest=e}if(this.options.threeDSecure||P.threeDSecureRequest){const e=Object.assign(Object.assign({},null!==(h=this.options.threeDSecure)&&void 0!==h?h:{}),null!==(f=P.threeDSecureRequest)&&void 0!==f?f:{});e.amount||(e.amount=o(null!==(g=r.amountMicros)&&void 0!==g?g:0)),!e.billingAddress&&r.billingAddress&&(e.billingAddress={givenName:r.billingAddress.givenName,surname:r.billingAddress.surname,countryCodeAlpha2:r.billingAddress.countryCode,postalCode:r.billingAddress.postalCode,locality:r.billingAddress.locality,streetAddress:r.billingAddress.streetAddress1,extendedAddress:r.billingAddress.streetAddress2,line3:r.billingAddress.streetAddress3,phoneNumber:r.billingAddress.phoneNumber,region:r.billingAddress.region}),e.email||(e.email=r.email),P.threeDSecureRequest=e}const y=await this.launchDropIn(r,P);if(!s(y))return a(this.log,y);const E=y;if(this.log.info("launchDropIn success: "+JSON.stringify({paymentRequest:r,dropInResult:E})),!(null===(m=E.paymentMethodNonce)||void 0===m?void 0:m.nonce))return e.storeError(e.ErrorCode.BAD_RESPONSE,"launchDropIn returned no paymentMethodNonce");let I=this._receipts.find((e=>{var t,i;return(null===(t=e.dropInResult.paymentMethodNonce)||void 0===t?void 0:t.nonce)===(null===(i=E.paymentMethodNonce)||void 0===i?void 0:i.nonce)}));return I?I.refresh(r,E,this.context.apiDecorators):(I=new i(r,E,this.context.apiDecorators),this.receipts.push(I)),this.context.listener.receiptsUpdated(e.Platform.BRAINTREE,[I]),I.transactions[0]}async receiptValidationBody(t){var i,r,o,s,a;if(n(t))return this.log.info("create receiptValidationBody for: "+JSON.stringify(t)),{id:null!==(o=null===(r=null===(i=t.paymentRequest.items)||void 0===i?void 0:i[0])||void 0===r?void 0:r.id)&&void 0!==o?o:"unknown",type:e.ProductType.CONSUMABLE,priceMicros:t.paymentRequest.amountMicros,currency:t.paymentRequest.currency,products:[],transaction:{type:e.Platform.BRAINTREE,deviceData:t.dropInResult.deviceData,id:"nonce",paymentMethodNonce:null!==(a=null===(s=t.dropInResult.paymentMethodNonce)||void 0===s?void 0:s.nonce)&&void 0!==a?a:"",paymentDescription:t.dropInResult.paymentDescription,paymentMethodType:t.dropInResult.paymentMethodType}};this.log.error("Unexpected error, expecting a BraintreeReceipt: "+JSON.stringify(t))}async handleReceiptValidationResponse(e,i){var r;if(this.log.info("receipt validation response: "+JSON.stringify(i)),(null===i||void 0===i?void 0:i.data)&&"transaction"in i.data&&"braintree"===i.data.transaction.type){const e=null===(r=i.data.transaction.data.transaction)||void 0===r?void 0:r.customer.id;e&&!t.customerId&&(this.log.info("customerId updated: "+e),t.customerId=e)}}checkSupport(e){return"requestPayment"===e}async restorePurchases(){}}function o(e){const t=""+e/1e4;return(t.slice(0,-2)||"0")+"."+(t.slice(-2,-1)||"0")+(t.slice(-1)||"0")}function n(t){return t.platform===e.Platform.BRAINTREE}t.Adapter=r;const s=e=>!!e&&!("code"in e&&"message"in e),a=(t,i)=>i?i.code===e.ErrorCode.PAYMENT_CANCELLED?void t.info("User cancelled the payment request"):(t.warn("launchDropIn failed: "+JSON.stringify(i)),i):(t.warn("launchDropIn failed: no response"),e.storeError(e.ErrorCode.BAD_RESPONSE,"Braintree failed to launch drop in"))})(t=e.Braintree||(e.Braintree={}))}(e||(e={})),function(e){let t;(function(t){const i="BraintreePlugin";let r;(function(t){class r{constructor(e){this.log=e.child("AndroidBridge")}listener(e){this.log.debug("listener: "+JSON.stringify(e)),e&&e.type&&("getClientToken"===e.type?this.getClientToken():e.type)}initialize(t,r){try{if("string"===typeof t){const e=t;this.clientTokenProvider=t=>{t(e)}}else this.clientTokenProvider=t;this.log.info("exec.setListener()");const e=this.listener.bind(this);window.cordova.exec(e,null,i,"setListener",[]),r(void 0)}catch(o){this.log.warn("initialization failed: "+(null===o||void 0===o?void 0:o.message)),r(e.storeError(e.ErrorCode.SETUP,"Failed to initialize Braintree Android Bridge: "+(null===o||void 0===o?void 0:o.message)))}}getClientToken(){this.log.info("getClientToken()"),this.clientTokenProvider?(this.log.debug("clientTokenProvider set, calling."),this.clientTokenProvider((e=>{"string"===typeof e?window.cordova.exec(null,null,i,"onClientTokenSuccess",[e]):window.cordova.exec(null,null,i,"onClientTokenFailure",[e.code,e.message])}))):(this.log.debug("clientTokenProvider not set, retrying later..."),setTimeout((()=>this.getClientToken()),1e3))}static isSupported(){return"android"===window.cordova.platformId}async isApplePaySupported(){return!1}launchDropIn(t){return new Promise((r=>{window.cordova.exec((e=>{this.log.info("dropInSuccess: "+JSON.stringify(e)),r(e)}),(t=>{this.log.info("dropInFailure: "+t);const i=t.split("|")[0],o=t.split("|").slice(1).join("");r("UserCanceledException"===i?e.storeError(e.ErrorCode.PAYMENT_CANCELLED,o):"AuthorizationException"===i?e.storeError(e.ErrorCode.UNAUTHORIZED_REQUEST_DATA,o):e.storeError(e.ErrorCode.UNKNOWN,t))}),i,"launchDropIn",[t])}))}}t.Bridge=r})(r=t.AndroidBridge||(t.AndroidBridge={}))})(t=e.Braintree||(e.Braintree={}))}(e||(e={})),function(e){let t;(function(t){let i;(function(t){const i="BraintreeApplePayPlugin";class r{static get(){return window.CdvPurchaseBraintreeApplePay}static requestPayment(t){return new Promise((o=>{var n;if(!(null===(n=r.get())||void 0===n?void 0:n.installed))return o(e.storeError(e.ErrorCode.SETUP,"cordova-plugin-purchase-braintree-applepay does not appear to be installed."));{const r=e=>{o(e)},n=t=>{const i=null!==t&&void 0!==t?t:"payment request failed";o(e.storeError(e.ErrorCode.PURCHASE,"Braintree+ApplePay ERROR: "+i))};window.cordova.exec(r,n,i,"presentDropInPaymentUI",[t])}}))}static isSupported(e){return new Promise((t=>{var o;if("ios"!==window.cordova.platformId)return e.info("BraintreeApplePayPlugin is only available for ios."),t(!1);if(!(null===(o=r.get())||void 0===o?void 0:o.installed))return e.info("BraintreeApplePayPlugin does not appear to be installed."),t(!1);try{window.cordova.exec((e=>{t(e)}),(()=>{e.info("BraintreeApplePayPlugin is not available."),t(!1)}),i,"isApplePaySupported",[])}catch(n){e.info("BraintreeApplePayPlugin is not installed."),t(!1)}}))}}t.ApplePayPlugin=r})(i=t.IosBridge||(t.IosBridge={}))})(t=e.Braintree||(e.Braintree={}))}(e||(e={})),function(e){let t;(function(t){let i;(function(i){class r{constructor(e,t,i){this.log=e.child("IosBridge"),this.clientTokenProvider=t,this.applePayOptions=i}initialize(e,t){window.cordova.exec(null,null,"BraintreePlugin","setVerbosity",[e.verbosity]),window.cordova.exec((e=>this.log.debug("(Native) "+e)),null,"BraintreePlugin","setLogger",[]),setTimeout((()=>t(void 0)),0)}async continueDropInForApplePay(t,r,o){var n,s,a,c,l,d,u,p,h;const f=(null===(s=null===(n=this.applePayOptions)||void 0===n?void 0:n.preparePaymentRequest)||void 0===s?void 0:s.call(n,t))||{merchantCapabilities:[e.ApplePay.MerchantCapability.ThreeDS]};if(!f.paymentSummaryItems){const e=t.items.filter((e=>e)).map(((e,i)=>{var r,o,n;return{type:"final",label:(null===e||void 0===e?void 0:e.title)||(null===e||void 0===e?void 0:e.id)||`Item #${i+1}`,amount:""+Math.round((null!==(n=null!==(o=null===(r=null===e||void 0===e?void 0:e.pricing)||void 0===r?void 0:r.priceMicros)&&void 0!==o?o:t.amountMicros)&&void 0!==n?n:0)/1e4)/100}})),i={type:"final",label:null!==(c=null===(a=this.applePayOptions)||void 0===a?void 0:a.companyName)&&void 0!==c?c:"Total",amount:""+Math.round((null!==(l=t.amountMicros)&&void 0!==l?l:0)/1e4)/100};f.paymentSummaryItems=[...e,i]}const g=await i.ApplePayPlugin.requestPayment(f);return this.log.info("Result from Apple Pay: "+JSON.stringify(g)),"isError"in g?g:g.userCancelled?e.storeError(e.ErrorCode.PAYMENT_CANCELLED,"User cancelled the payment request"):{paymentMethodNonce:{isDefault:!1,nonce:null!==(u=null===(d=g.applePayCardNonce)||void 0===d?void 0:d.nonce)&&void 0!==u?u:"",type:null!==(h=null===(p=g.applePayCardNonce)||void 0===p?void 0:p.type)&&void 0!==h?h:""},paymentMethodType:o.paymentMethodType,deviceData:o.deviceData,paymentDescription:o.paymentDescription}}launchDropIn(i,r){return new Promise((async o=>{const n=e=>{this.log.info("dropInSuccess: "+JSON.stringify(e)),e.paymentMethodType===t.DropIn.PaymentMethod.APPLE_PAY?(this.log.info("it's an ApplePay request, we have to process it."),this.continueDropInForApplePay(i,r,e).then(o)):o(e)},s=t=>{this.log.info("dropInFailure: "+t);const[i,r]=t.split("|");o("UserCanceledException"===i?e.storeError(e.ErrorCode.PAYMENT_CANCELLED,r):e.storeError(e.ErrorCode.UNKNOWN,"ERROR "+i+": "+r))};this.clientTokenProvider((e=>{"string"===typeof e?window.cordova.exec(n,s,"BraintreePlugin","launchDropIn",[e,r]):o(e)}))}))}braintreePlugin(){return window.CdvPurchaseBraintree}static isSupported(){return"ios"===window.cordova.platformId}}i.Bridge=r})(i=t.IosBridge||(t.IosBridge={}))})(t=e.Braintree||(e.Braintree={}))}(e||(e={})),function(e){let t;(function(e){let t;(function(e){let t;(function(e){e[e["DISABLED"]=0]="DISABLED",e[e["OPTIONAL"]=1]="OPTIONAL",e[e["REQUIRED"]=2]="REQUIRED"})(t=e.CardFormFieldStatus||(e.CardFormFieldStatus={}))})(t=e.DropIn||(e.DropIn={}))})(t=e.Braintree||(e.Braintree={}))}(e||(e={})),function(e){let t;(function(e){let t;(function(e){let t;(function(e){e["GOOGLE_PAY"]="GOOGLE_PAY",e["LASER"]="LASER",e["UK_MAESTRO"]="UK_MAESTRO",e["SWITCH"]="SWITCH",e["SOLOR"]="SOLO",e["APPLE_PAY"]="APPLE_PAY",e["AMEX"]="AMEX",e["DINERS_CLUB"]="DINERS_CLUB",e["DISCOVER"]="DISCOVER",e["JCB"]="JCB",e["MAESTRO"]="MAESTRO",e["MASTERCARD"]="MASTERCARD",e["PAYPAL"]="PAYPAL",e["VISA"]="VISA",e["VENMO"]="VENMO",e["UNIONPAY"]="UNIONPAY",e["HIPER"]="HIPER",e["HIPERCARD"]="HIPERCARD",e["UNKNOWN"]="UNKNOWN"})(t=e.PaymentMethod||(e.PaymentMethod={}))})(t=e.DropIn||(e.DropIn={}))})(t=e.Braintree||(e.Braintree={}))}(e||(e={})),function(e){let t;(function(e){let t;(function(e){let t,i;(function(e){e[e["MIN"]=0]="MIN",e[e["FULL"]=1]="FULL"})(t=e.BillingAddressFormat||(e.BillingAddressFormat={})),function(e){e[e["NOT_CURRENTLY_KNOWN"]=1]="NOT_CURRENTLY_KNOWN",e[e["ESTIMATED"]=2]="ESTIMATED",e[e["FINAL"]=3]="FINAL"}(i=e.TotalPriceStatus||(e.TotalPriceStatus={}))})(t=e.GooglePay||(e.GooglePay={}))})(t=e.Braintree||(e.Braintree={}))}(e||(e={})),function(e){let t;(function(e){let t;(function(e){let t,i,r;(function(e){e["UNSPECIFIED"]="00",e["CREDIT"]="01",e["DEBIT"]="02"})(t=e.AccountType||(e.AccountType={})),function(e){e[e["UNSPECIFIED"]=0]="UNSPECIFIED",e[e["SAME_DAY"]=1]="SAME_DAY",e[e["EXPEDITED"]=2]="EXPEDITED",e[e["PRIORITY"]=3]="PRIORITY",e[e["GROUND"]=4]="GROUND",e[e["ELECTRONIC_DELIVERY"]=5]="ELECTRONIC_DELIVERY",e[e["SHIP_TO_STORE"]=6]="SHIP_TO_STORE"}(i=e.ShippingMethod||(e.ShippingMethod={})),function(e){e[e["V1"]=0]="V1",e[e["V2"]=1]="V2"}(r=e.Version||(e.Version={}))})(t=e.ThreeDSecure||(e.ThreeDSecure={}))})(t=e.Braintree||(e.Braintree={}))}(e||(e={})),function(e){let t;(function(t){class i extends e.Transaction{constructor(t,i,r){super(e.Platform.GOOGLE_PLAY,i,r),this.nativePurchase=t,this.refresh(t)}static toState(i,r){switch(i){case t.Bridge.PurchaseState.PENDING:return e.TransactionState.INITIATED;case t.Bridge.PurchaseState.PURCHASED:return e.TransactionState.APPROVED;case t.Bridge.PurchaseState.UNSPECIFIED_STATE:return e.TransactionState.UNKNOWN_STATE}}refresh(r){this.nativePurchase=r,this.transactionId=`${r.orderId||r.purchaseToken}`,this.purchaseId=`${r.purchaseToken}`,this.products=r.productIds.map((e=>({id:e}))),r.purchaseTime&&(this.purchaseDate=new Date(r.purchaseTime)),this.isPending=r.getPurchaseState===t.Bridge.PurchaseState.PENDING,"undefined"!==typeof r.acknowledged&&(this.isAcknowledged=r.acknowledged),"undefined"!==typeof r.autoRenewing&&(this.renewalIntent=r.autoRenewing?e.RenewalIntent.RENEW:e.RenewalIntent.LAPSE),this.state=i.toState(r.getPurchaseState,r.acknowledged)}}t.Transaction=i;class r extends e.Receipt{constructor(t,r){super(e.Platform.GOOGLE_PLAY,r),this.transactions=[new i(t,this,r)],this.purchaseToken=t.purchaseToken,this.orderId=t.orderId}refreshPurchase(e){var t;null===(t=this.transactions[0])||void 0===t||t.refresh(e),this.orderId=e.orderId}}t.Receipt=r;class o{constructor(i,r=864e5){if(this.id=e.Platform.GOOGLE_PLAY,this.name="GooglePlay",this.ready=!1,this._receipts=[],this.bridge=new t.Bridge.Bridge,this.initialized=!1,this.retry=new e.Internal.Retry,this.autoRefreshIntervalMillis=0,o._instance)throw new Error("GooglePlay adapter already initialized");this._products=new t.Products(i.apiDecorators),this.autoRefreshIntervalMillis=r,this.context=i,this.log=i.log.child("GooglePlay"),o._instance=this}get products(){return this._products.products}get receipts(){return this._receipts}get isSupported(){return"android"===window.cordova.platformId}async initialize(){return this.log.info("Initialize"),this.initializationPromise?this.initializationPromise:this.initializationPromise=new Promise((t=>{const i=this.log.child("Bridge"),r={onSetPurchases:this.onSetPurchases.bind(this),onPurchasesUpdated:this.onPurchasesUpdated.bind(this),onPurchaseConsumed:this.onPurchaseConsumed.bind(this),showLog:this.context.verbosity>=e.LogLevel.DEBUG,log:e=>i.info(e)},o=()=>{this.log.debug("Ready"),this.autoRefreshIntervalMillis>0&&window.setInterval((()=>this.getPurchases()),this.autoRefreshIntervalMillis),t(void 0)},n=t=>{this.initialized=!1,this.context.error(e.storeError(e.ErrorCode.SETUP,"Init failed - "+t)),this.retry.retry((()=>this.initialize()))};this.bridge.init(o,n,r)}))}getSkusOf(t){const i=[],r=[];for(const o of t)o.type===e.ProductType.PAID_SUBSCRIPTION?r.push(o.id):i.push(o.id);return{inAppSkus:i,subsSkus:r}}loadReceipts(){return new Promise((e=>{this.getPurchases().then((t=>{e(this._receipts)}))}))}loadProducts(t){return new Promise((i=>{this.log.debug("Load: "+JSON.stringify(t));const r=r=>{this.log.debug("Loaded: "+JSON.stringify(r));const o=t.map((t=>{const i=r.find((e=>e.productId===t.id));return i&&i.productId?this._products.addProduct(t,i):e.storeError(e.ErrorCode.INVALID_PRODUCT_ID,`Product with id ${t.id} not found.`)}));i(o)},o=()=>{const{inAppSkus:i,subsSkus:n}=this.getSkusOf(t);this.log.debug("getAvailableProducts: "+JSON.stringify(i)+" | "+JSON.stringify(n)),this.bridge.getAvailableProducts(i,n,r,(t=>{this.retry.retry(o),this.context.error(e.storeError(e.ErrorCode.LOAD,"Loading product info failed - "+t+" - retrying later..."))}))};o()}))}finish(t){return new Promise((i=>{const r=()=>{t.state!==e.TransactionState.FINISHED&&(t.state=e.TransactionState.FINISHED,this.context.listener.receiptsUpdated(e.Platform.GOOGLE_PLAY,[t.parentReceipt])),i(void 0)},o=(t,r)=>i(e.storeError(r||e.ErrorCode.UNKNOWN,t)),n=t.products[0];if(!n)return i(e.storeError(e.ErrorCode.FINISH,"Cannot finish a transaction with no product"));const s=this._products.getProduct(n.id);if(!s)return i(e.storeError(e.ErrorCode.FINISH,"Cannot finish transaction, unknown product "+n.id));const a=this._receipts.find((e=>e.hasTransaction(t)));if(!a)return i(e.storeError(e.ErrorCode.FINISH,"Cannot finish transaction, linked receipt not found."));if(!a.purchaseToken)return i(e.storeError(e.ErrorCode.FINISH,"Cannot finish transaction, linked receipt contains no purchaseToken."));if(s.type===e.ProductType.NON_RENEWING_SUBSCRIPTION||s.type===e.ProductType.CONSUMABLE){if(!t.isConsumed)return this.bridge.consumePurchase(r,o,a.purchaseToken)}else if(!t.isAcknowledged)return this.bridge.acknowledgePurchase(r,o,a.purchaseToken);i(void 0)}))}onPurchaseConsumed(e){this.log.debug("onPurchaseConsumed: "+e.orderId),e.acknowledged=!0,this.onPurchasesUpdated([e])}onPurchasesUpdated(t){this.log.debug("onPurchaseUpdated: "+t.map((e=>e.orderId)).join(", ")),t.forEach((t=>{const i=this.receipts.find((e=>e.purchaseToken===t.purchaseToken));if(i)i.refreshPurchase(t),this.context.listener.receiptsUpdated(e.Platform.GOOGLE_PLAY,[i]);else{const i=new r(t,this.context.apiDecorators);this.receipts.push(i),this.context.listener.receiptsUpdated(e.Platform.GOOGLE_PLAY,[i])}}))}onSetPurchases(t){this.log.debug("onSetPurchases: "+JSON.stringify(t)),this.onPurchasesUpdated(t),this.context.listener.receiptsReady(e.Platform.GOOGLE_PLAY)}onPriceChangeConfirmationResult(e){}getPurchases(){return new Promise((t=>{this.log.debug("getPurchases");const i=()=>{this.log.debug("getPurchases success"),setTimeout((()=>t(void 0)),0)},r=(i,r)=>{this.log.warn("getPurchases failed: "+i+" ("+r+")"),setTimeout((()=>t(e.storeError(r||e.ErrorCode.UNKNOWN,i))),0)};this.bridge.getPurchases(i,r)}))}async order(t,i){return new Promise((r=>{this.log.info("Order - "+JSON.stringify(t));const o=()=>r(void 0),n=(t,i)=>{this.log.warn("Order failed: "+JSON.stringify({message:t,code:i})),r(e.storeError(null!==i&&void 0!==i?i:e.ErrorCode.UNKNOWN,t))};if(t.productType===e.ProductType.PAID_SUBSCRIPTION){const e=t.id,r=this.findOldPurchaseToken(t.productId,t.productGroup);r&&(i.googlePlay?i.googlePlay.oldPurchaseToken||(i.googlePlay.oldPurchaseToken=r):i.googlePlay={oldPurchaseToken:r}),this.bridge.subscribe(o,n,e,i)}else this.bridge.buy(o,n,t.productId,i)}))}findOldPurchaseToken(t,i){if(!i)return;const r=this._receipts.find((r=>!!r.transactions.find((o=>!!o.products.find((o=>{const n=this._products.getProduct(o.id);return!!n&&(!!e.Internal.LocalReceipts.isOwned([r],n)&&(o.id===t||i&&n.group===i))}))))));return null===r||void 0===r?void 0:r.purchaseToken}async receiptValidationBody(t){var i;const r=t.transactions[0];if(!r)return;const o=null===(i=r.products[0])||void 0===i?void 0:i.id;if(!o)return;const n=this._products.getProduct(o);if(!n)return;const s=r.nativePurchase;return{id:o,type:n.type,offers:n.offers,products:this._products.products,transaction:{type:e.Platform.GOOGLE_PLAY,id:t.transactions[0].transactionId,purchaseToken:s.purchaseToken,signature:s.signature,receipt:s.receipt}}}async handleReceiptValidationResponse(t,i){var r;if(null===i||void 0===i?void 0:i.ok){const t=null===(r=null===i||void 0===i?void 0:i.data)||void 0===r?void 0:r.transaction;if((null===t||void 0===t?void 0:t.type)!==e.Platform.GOOGLE_PLAY)return;switch(t.kind){case"androidpublisher#productPurchase":break;case"androidpublisher#subscriptionPurchase":break;case"androidpublisher#subscriptionPurchaseV2":break;case"fovea#subscriptionGone":break}}}async requestPayment(t,i){return e.storeError(e.ErrorCode.UNKNOWN,"requestPayment not supported")}async manageSubscriptions(){this.bridge.manageSubscriptions()}async manageBilling(){this.bridge.manageBilling()}checkSupport(e){const t=["order","manageBilling","manageSubscriptions"];return t.indexOf(e)>=0}restorePurchases(){return new Promise((e=>{this.bridge.getPurchases(e,((t,i)=>{this.log.warn("getPurchases() failed: "+(null!==i&&void 0!==i?i:"ERROR")+": "+t),e()}))}))}}t.Adapter=o})(t=e.GooglePlay||(e.GooglePlay={}))}(e||(e={})),function(e){let t;(function(e){let t;(function(e){let t;(function(e){e["FINITE_RECURRING"]="FINITE_RECURRING",e["INFINITE_RECURRING"]="INFINITE_RECURRING",e["NON_RECURRING"]="NON_RECURRING"})(t=e.RecurrenceMode||(e.RecurrenceMode={}))})(t=e.Bridge||(e.Bridge={}))})(t=e.GooglePlay||(e.GooglePlay={}))}(e||(e={})),function(e){let t;(function(t){let i,r;(function(e){e["IMMEDIATE_WITH_TIME_PRORATION"]="IMMEDIATE_WITH_TIME_PRORATION",e["IMMEDIATE_AND_CHARGE_PRORATED_PRICE"]="IMMEDIATE_AND_CHARGE_PRORATED_PRICE",e["IMMEDIATE_WITHOUT_PRORATION"]="IMMEDIATE_WITHOUT_PRORATION",e["DEFERRED"]="DEFERRED",e["IMMEDIATE_AND_CHARGE_FULL_PRICE"]="IMMEDIATE_AND_CHARGE_FULL_PRICE"})(i=t.ProrationMode||(t.ProrationMode={})),function(t){let i,r=function(e){console.log("InAppBilling[js]: "+e)};(function(e){e[e["UNSPECIFIED_STATE"]=0]="UNSPECIFIED_STATE",e[e["PURCHASED"]=1]="PURCHASED",e[e["PENDING"]=2]="PENDING"})(i=t.PurchaseState||(t.PurchaseState={}));class o{constructor(){this.options={}}init(e,t,i){i||(i={}),i.log&&(r=i.log),this.options={showLog:!1!==i.showLog,onPurchaseConsumed:i.onPurchaseConsumed,onPurchasesUpdated:i.onPurchasesUpdated,onSetPurchases:i.onSetPurchases},this.options.showLog&&r("setup ok");const o=this.listener.bind(this);window.cordova.exec(o,(function(e){}),"InAppBillingPlugin","setListener",[]),window.cordova.exec(e,n(t),"InAppBillingPlugin","init",[])}load(t,i,o,s,a){if("undefined"!==typeof o&&("string"===typeof o&&(o=[o]),o.length>0)){if("string"!==typeof o[0]){var c="invalid productIds: "+JSON.stringify(o);return this.options.showLog&&r(c),void i(c,e.ErrorCode.INVALID_PRODUCT_ID)}this.options.showLog&&r("load "+JSON.stringify(o)),!0}window.cordova.exec(t,n(i),"InAppBillingPlugin","load",[o,s,a])}listener(e){this.options.showLog&&r("listener: "+JSON.stringify(e)),e&&e.type&&("setPurchases"===e.type&&this.options.onSetPurchases&&this.options.onSetPurchases(e.data.purchases),"purchasesUpdated"===e.type&&this.options.onPurchasesUpdated&&this.options.onPurchasesUpdated(e.data.purchases),"purchaseConsumed"===e.type&&this.options.onPurchaseConsumed&&this.options.onPurchaseConsumed(e.data.purchase),"onPriceChangeConfirmationResultOK"===e.type&&this.options.onPriceChangeConfirmationResult&&this.options.onPriceChangeConfirmationResult("OK"),"onPriceChangeConfirmationResultUserCanceled"===e.type&&this.options.onPriceChangeConfirmationResult&&this.options.onPriceChangeConfirmationResult("UserCanceled"),"onPriceChangeConfirmationResultUnknownSku"===e.type&&this.options.onPriceChangeConfirmationResult&&this.options.onPriceChangeConfirmationResult("UnknownProduct"))}getPurchases(e,t){return this.options.showLog&&r("getPurchases()"),window.cordova.exec(e,n(t),"InAppBillingPlugin","getPurchases",["null"])}buy(e,t,i,o){return this.options.showLog&&r("buy()"),window.cordova.exec(e,n(t),"InAppBillingPlugin","buy",[i,a(o)])}subscribe(e,t,i,o){var s;return this.options.showLog&&r("subscribe()"),(null===(s=o.googlePlay)||void 0===s?void 0:s.oldPurchaseToken)&&this.options.showLog&&r("subscribe() -> upgrading from an old purchase"),window.cordova.exec(e,n(t),"InAppBillingPlugin","subscribe",[i,a(o)])}consumePurchase(e,t,i){return this.options.showLog&&r("consumePurchase()"),window.cordova.exec(e,n(t),"InAppBillingPlugin","consumePurchase",[i])}acknowledgePurchase(e,t,i){return this.options.showLog&&r("acknowledgePurchase()"),window.cordova.exec(e,n(t),"InAppBillingPlugin","acknowledgePurchase",[i])}getAvailableProducts(e,t,i,o){return this.options.showLog&&r("getAvailableProducts()"),window.cordova.exec(i,n(o),"InAppBillingPlugin","getAvailableProducts",[e,t])}manageSubscriptions(){return window.cordova.exec((function(){}),(function(){}),"InAppBillingPlugin","manageSubscriptions",[])}manageBilling(){return window.cordova.exec((function(){}),(function(){}),"InAppBillingPlugin","manageBilling",[])}launchPriceChangeConfirmationFlow(e){return window.cordova.exec((function(){}),(function(){}),"InAppBillingPlugin","launchPriceChangeConfirmationFlow",[e])}}function n(e){return function(t){if(!e)return;const i="string"===typeof t?t.split("|"):[];if(i.length>1&&/^[-+]?(\d+)$/.test(i[0])){var r=i[0],o=i[1];e(o,+r)}else e(t)}}function s(e){return e&&e.constructor===Object?e:{}}function a(t){const i=s(null===t||void 0===t?void 0:t.googlePlay);return!i.accountId&&(null===t||void 0===t?void 0:t.applicationUsername)&&(i.accountId=e.Utils.md5(t.applicationUsername)),i}t.Bridge=o}(r=t.Bridge||(t.Bridge={}))})(t=e.GooglePlay||(e.GooglePlay={}))}(e||(e={})),function(e){let t;(function(t){class i extends e.Product{}t.GProduct=i;class r extends e.Offer{constructor(){super(...arguments),this.type="inapp"}}t.InAppOffer=r;class o extends e.Offer{constructor(e,t){super(e,t),this.type="subs",this.tags=e.tags,this.token=e.token}}t.SubscriptionOffer=o;class n{constructor(e){this.products=[],this.offers=[],this.decorator=e}getProduct(e){return this.products.find((t=>t.id===e))}getOffer(e){return this.offers.find((t=>t.id===e))}addProduct(e,t){const r=this.getProduct(e.id),o=null!==r&&void 0!==r?r:new i(e,this.decorator);return o.title=t.title||t.name||o.title,o.description=t.description||o.description,"product_format"in t&&"v12.0"===t.product_format&&"subs"===t.product_type?this.onSubsV12Loaded(o,t):this.onInAppLoaded(o,t),r||this.products.push(o),o}onSubsV12Loaded(e,t){return t.offers.forEach((i=>{const r=this.iabSubsOfferV12Loaded(e,t,i);e.addOffer(r)})),e}iabSubsOfferV12Loaded(e,t,i){const r=t.productId+"@"+i.token,n=this.getOffer(r),s=i.pricing_phases.map((e=>this.toPricingPhase(e)));if(n)return n.pricingPhases=s,n;{const t=new o({id:r,product:e,pricingPhases:s,token:i.token,tags:i.tags},this.decorator);return this.offers.push(t),t}}onInAppLoaded(t,i){var o,n,s,a;const c=this.getOffer(i.productId),l=[{price:null!==(n=null!==(o=i.formatted_price)&&void 0!==o?o:i.price)&&void 0!==n?n:`${(null!==(s=i.price_amount_micros)&&void 0!==s?s:0)/1e6} ${i.price_currency_code}`,priceMicros:null!==(a=i.price_amount_micros)&&void 0!==a?a:0,currency:i.price_currency_code,recurrenceMode:e.RecurrenceMode.NON_RECURRING}];if(c)c.pricingPhases=l,t.offers=[c];else{const e=new r({id:i.productId,product:t,pricingPhases:l},this.decorator);this.offers.push(e),t.offers=[e]}return t}toPaymentMode(i){return 0===i.price_amount_micros?e.PaymentMode.FREE_TRIAL:i.recurrence_mode===t.Bridge.RecurrenceMode.NON_RECURRING?e.PaymentMode.UP_FRONT:e.PaymentMode.PAY_AS_YOU_GO}toRecurrenceMode(i){switch(i){case t.Bridge.RecurrenceMode.FINITE_RECURRING:return e.RecurrenceMode.FINITE_RECURRING;case t.Bridge.RecurrenceMode.INFINITE_RECURRING:return e.RecurrenceMode.INFINITE_RECURRING;case t.Bridge.RecurrenceMode.NON_RECURRING:return e.RecurrenceMode.NON_RECURRING}}toPricingPhase(e){return{price:e.formatted_price,priceMicros:e.price_amount_micros,currency:e.price_currency_code,billingPeriod:e.billing_period,billingCycles:e.billing_cycle_count,recurrenceMode:this.toRecurrenceMode(e.recurrence_mode),paymentMode:this.toPaymentMode(e)}}}t.Products=n})(t=e.GooglePlay||(e.GooglePlay={}))}(e||(e={})),function(e){let t;(function(e){let t;(function(e){let t,i;(function(e){e["SUBSCRIPTION_NO_LONGER_AVAILABLE"]="subscriptionPurchaseNoLongerAvailable",e["PURCHASE_TOKEN_NO_LONGER_VALID"]="purchaseTokenNoLongerValid"})(t=e.GoogleErrorReason||(e.GoogleErrorReason={})),function(e){e[e["GONE"]=410]="GONE"}(i=e.ErrorCode||(e.ErrorCode={}))})(t=e.PublisherAPI||(e.PublisherAPI={}))})(t=e.GooglePlay||(e.GooglePlay={}))}(e||(e={})),function(e){let t;(function(t){const i=e.Platform.TEST;let r=[];function o(e){e.products.forEach((t=>{var i,o,n,s;const a=r.find((e=>t.id===e.id)),c={id:t.id,purchaseDate:null===(i=e.purchaseDate)||void 0===i?void 0:i.getTime(),expiryDate:null===(o=e.expirationDate)||void 0===o?void 0:o.getTime(),lastRenewalDate:null===(n=e.lastRenewalDate)||void 0===n?void 0:n.getTime(),renewalIntent:e.renewalIntent,renewalIntentChangeDate:null===(s=e.renewalIntentChangeDate)||void 0===s?void 0:s.getTime()};a?Object.assign(a,c):r.push(c)}))}class n{constructor(t){this.id=e.Platform.TEST,this.name="Test",this.ready=!1,this.products=[],this.receipts=[],this.context=t,this.log=t.log.child("Test")}get isSupported(){return!0}async initialize(){}async loadReceipts(){return new Promise((t=>{setTimeout((()=>{this.context.listener.receiptsReady(e.Platform.TEST),t(this.receipts)}),600)}))}async loadProducts(i){return i.map((i=>{if(!t.testProductsArray.find((e=>e.id===i.id&&e.type===i.type)))return e.storeError(e.ErrorCode.PRODUCT_NOT_AVAILABLE,"This product is not available");const r=this.products.find((e=>e.id===i.id));if(r)return r;i.id===t.testProducts.PAID_SUBSCRIPTION_ACTIVE.id&&setTimeout((()=>{this.reportActiveSubscription()}),500);const o=t.initTestProduct(i.id,this.context.apiDecorators);return o?(this.products.push(o),this.context.listener.productsUpdated(e.Platform.TEST,[o]),o):e.storeError(e.ErrorCode.PRODUCT_NOT_AVAILABLE,"Could not load this product")}))}async order(t){if(t.id.indexOf("-fail-")>0)return e.storeError(e.ErrorCode.PURCHASE,"Purchase failed.");const r=this.products.find((e=>e.id===t.productId));if(!e.Internal.LocalReceipts.canPurchase(this.receipts,r))return e.storeError(e.ErrorCode.PURCHASE,"Product already owned");const n=prompt(`Do you want to purchase ${t.productId} for ${t.pricingPhases[0].price}?\nEnter "Y" to confirm.\nEnter "E" to fail with an error.Anything else to cancel.`);if("E"===(null===n||void 0===n?void 0:n.toUpperCase()))return e.storeError(e.ErrorCode.PURCHASE,"Purchase failed");if("Y"!==(null===n||void 0===n?void 0:n.toUpperCase()))return e.storeError(e.ErrorCode.PAYMENT_CANCELLED,"Purchase flow has been cancelled by the user");const s=new e.Receipt(i,this.context.apiDecorators),a=new e.Transaction(i,s,this.context.apiDecorators);s.transactions=[a],a.products=[{id:t.productId,offerId:t.id}],a.state=e.TransactionState.APPROVED,a.purchaseDate=new Date,a.transactionId=t.productId+"-"+(new Date).getTime(),a.isAcknowledged=!1,o(a),this.receipts.push(s),this.context.listener.receiptsUpdated(e.Platform.TEST,[s])}finish(t){return new Promise((r=>{setTimeout((()=>{t.state=e.TransactionState.FINISHED,t.isAcknowledged=!0,o(t);const n=this.products.find((e=>t.products[0].id===e.id));(null===n||void 0===n?void 0:n.type)===e.ProductType.CONSUMABLE&&(t.isConsumed=!0);const s=this.receipts.filter((e=>e.hasTransaction(t)));this.context.listener.receiptsUpdated(i,s),r(void 0)}),500)}))}async receiptValidationBody(e){}async handleReceiptValidationResponse(e,t){}async requestPayment(t,r){var o;await e.Utils.asyncDelay(100);const n=prompt(`Mock payment of ${(null!==(o=t.amountMicros)&&void 0!==o?o:0)/1e6} ${t.currency}. Enter "Y" to confirm. Enter "E" to trigger an error.`);if("E"===(null===n||void 0===n?void 0:n.toUpperCase()))return e.storeError(e.ErrorCode.PAYMENT_NOT_ALLOWED,"Payment not allowed");if("Y"!==(null===n||void 0===n?void 0:n.toUpperCase()))return;const s=new e.Receipt(i,this.context.apiDecorators),a=new e.Transaction(e.Platform.TEST,s,this.context.apiDecorators);return a.purchaseDate=new Date,a.products=t.items.filter((e=>e)).map((e=>({id:(null===e||void 0===e?void 0:e.id)||""}))),a.state=e.TransactionState.APPROVED,a.transactionId="payment-"+(new Date).getTime(),a.amountMicros=t.amountMicros,a.currency=t.currency,s.transactions=[a],this.receipts.push(s),setTimeout((()=>{this.context.listener.receiptsUpdated(i,[s])}),400),a}async manageSubscriptions(){alert("Pseudo subscription management interface. Close it when you are done.")}async manageBilling(){alert("Pseudo billing management interface. Close it when you are done.")}reportActiveSubscription(){if(this.receipts.find((e=>e.transactions[0].transactionId===a(1))))return;const r=12e4,n=new e.Receipt(i,this.context.apiDecorators),s=s=>{var c,l;const d=new e.Transaction(i,n,this.context.apiDecorators);d.products=[{id:t.testProducts.PAID_SUBSCRIPTION_ACTIVE.id,offerId:t.testProducts.PAID_SUBSCRIPTION_ACTIVE.extra.offerId}],d.state=e.TransactionState.APPROVED,d.transactionId=a(s),d.isAcknowledged=1==s,d.renewalIntent=e.RenewalIntent.RENEW;const u=+((null===(l=null===(c=null===n||void 0===n?void 0:n.transactions)||void 0===c?void 0:c[0])||void 0===l?void 0:l.purchaseDate)||new Date);return d.purchaseDate=new Date(u),d.lastRenewalDate=new Date(u+r*(s-1)),d.expirationDate=new Date(u+r*s),o(d),d};function a(e){return"test-active-subscription-transaction-"+e}n.transactions.push(s(1)),this.receipts.push(n),this.context.listener.receiptsUpdated(e.Platform.TEST,[n]);let c=1;setInterval((()=>{this.log.info("auto-renewing the mock subscription"),c+=1,n.transactions.push(s(c)),this.context.listener.receiptsUpdated(e.Platform.TEST,[n])}),r)}static verify(e,t){setTimeout((()=>{var i,o;t({receipt:e,payload:{ok:!0,data:{id:null===(o=null===(i=e.transactions[0])||void 0===i?void 0:i.products[0])||void 0===o?void 0:o.id,latest_receipt:!0,transaction:{type:"test"},collection:r}}})}),500)}checkSupport(e){return!0}async restorePurchases(){}}t.Adapter=n})(t=e.Test||(e.Test={}))}(e||(e={})),function(e){let t;(function(t){const i=e.Platform.TEST;function r(i,r){const o=Object.keys(t.testProducts).find((e=>t.testProducts[e]&&t.testProducts[e].id===i));if(!o)return;const n=new e.Product(t.testProducts[o],r);switch(o){case"CONSUMABLE":n.title="Test Consumable",n.description="A consumable product that you can purchase",n.addOffer(new e.Offer({id:"test-consumable-offer1",pricingPhases:[{price:"$4.99",currency:"USD",priceMicros:499e4,paymentMode:e.PaymentMode.UP_FRONT,recurrenceMode:e.RecurrenceMode.NON_RECURRING}],product:n},r));break;case"CONSUMABLE_FAILING":n.title="Failing Consumable",n.description="A consumable product that cannot be purchased",n.addOffer(new e.Offer({id:"test-consumable-fail-offer1",pricingPhases:[{price:"$1.99",currency:"USD",priceMicros:199e4,paymentMode:e.PaymentMode.UP_FRONT,recurrenceMode:e.RecurrenceMode.NON_RECURRING}],product:n},r));break;case"NON_CONSUMABLE":n.title="Non Consumable",n.description="A non consumable product",n.addOffer(new e.Offer({id:"test-non-consumable-offer1",pricingPhases:[{price:"$9.99",currency:"USD",priceMicros:999e4,paymentMode:e.PaymentMode.UP_FRONT,recurrenceMode:e.RecurrenceMode.NON_RECURRING}],product:n},r));break;case"PAID_SUBSCRIPTION":n.title="A subscription product",n.description="An auto-renewing paid subscription with a trial period",n.addOffer(new e.Offer({id:"test-paid-subscription-offer1",product:n,pricingPhases:[{price:"$0.00",currency:"USD",priceMicros:0,paymentMode:e.PaymentMode.FREE_TRIAL,recurrenceMode:e.RecurrenceMode.FINITE_RECURRING,billingCycles:3,billingPeriod:"P1W"},{price:"$4.99",currency:"USD",priceMicros:499e4,paymentMode:e.PaymentMode.PAY_AS_YOU_GO,recurrenceMode:e.RecurrenceMode.INFINITE_RECURRING,billingPeriod:"P1M"}]},r));break;case"PAID_SUBSCRIPTION_ACTIVE":n.title="An owned subscription product",n.description="An active paid subscription",n.addOffer(new e.Offer({id:t.testProducts.PAID_SUBSCRIPTION_ACTIVE.extra.offerId,product:n,pricingPhases:[{price:"$19.99",currency:"USD",priceMicros:1999e4,paymentMode:e.PaymentMode.PAY_AS_YOU_GO,recurrenceMode:e.RecurrenceMode.INFINITE_RECURRING,billingPeriod:"P1Y"}]},r));break;default:const i=o;throw new Error(`Unhandled enum case: ${i}`)}return n}t.testProducts={CONSUMABLE:{platform:i,id:"test-consumable",type:e.ProductType.CONSUMABLE},CONSUMABLE_FAILING:{platform:i,id:"test-consumable-fail",type:e.ProductType.CONSUMABLE},NON_CONSUMABLE:{platform:i,id:"test-non-consumable",type:e.ProductType.NON_CONSUMABLE},PAID_SUBSCRIPTION:{platform:i,id:"test-subscription",type:e.ProductType.PAID_SUBSCRIPTION},PAID_SUBSCRIPTION_ACTIVE:{platform:i,id:"test-subscription-active",type:e.ProductType.PAID_SUBSCRIPTION,extra:{offerId:"test-paid-subscription-active-offer1"}}},t.testProductsArray=Object.values(t.testProducts),t.initTestProduct=r})(t=e.Test||(e.Test={}))}(e||(e={})),function(e){let t;(function(t){class i{constructor(){this.id=e.Platform.WINDOWS_STORE,this.name="WindowsStore",this.ready=!1,this.products=[],this.receipts=[]}async initialize(){}get isSupported(){return!1}async loadProducts(t){return t.map((t=>e.storeError(e.ErrorCode.PRODUCT_NOT_AVAILABLE,"TODO")))}async loadReceipts(){return[]}async order(t){return e.storeError(e.ErrorCode.UNKNOWN,"TODO: Not implemented")}async finish(t){return e.storeError(e.ErrorCode.UNKNOWN,"TODO: Not implemented")}async handleReceiptValidationResponse(e,t){}async receiptValidationBody(e){}async requestPayment(t,i){return e.storeError(e.ErrorCode.UNKNOWN,"requestPayment not supported")}async manageSubscriptions(){return e.storeError(e.ErrorCode.UNKNOWN,"manageSubscriptions not supported")}async manageBilling(){return e.storeError(e.ErrorCode.UNKNOWN,"manageBilling not supported")}checkSupport(e){return!1}async restorePurchases(){}}t.Adapter=i})(t=e.WindowsStore||(e.WindowsStore={}))}(e||(e={})),function(e){let t;(function(e){let t;function i(i,o){if("undefined"!==typeof window&&window.cordova&&window.cordova.plugin&&window.cordova.plugin.http)return r(i,o);var n=function(){},s=new XMLHttpRequest;o.timeout&&(s.timeout=o.timeout,s.ontimeout=function(){i.warn("ajax -> request to "+o.url+" timeout"),e.callExternal(i,"ajax.error",o.error,t.HTTP_REQUEST_TIMEOUT,"Timeout")}),s.open(o.method||"POST",o.url,!0),s.onreadystatechange=function(){try{4===s.readyState&&(200===s.status?e.callExternal(i,"ajax.success",o.success,JSON.parse(s.responseText)):(i.warn("ajax -> request to "+o.url+" failed with status "+s.status+" ("+s.statusText+")"),e.callExternal(i,"ajax.error",o.error,s.status,s.statusText)))}catch(t){i.warn("ajax -> request to "+o.url+" failed with an exception: "+t.message),o.error&&o.error(417,t.message,null)}4===s.readyState&&e.callExternal(i,"ajax.done",n)};const a=o.customHeaders;return a&&Object.keys(a).forEach((function(e){i.debug("ajax -> adding custom header: "+e),s.setRequestHeader(e,a[e])})),s.setRequestHeader("Accept","application/json"),i.debug("ajax -> send request to "+o.url),o.data?(s.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.send(JSON.stringify(o.data))):s.send(),{done:function(e){return n=e,this}}}function r(t,i){let r=function(){};const o={method:(i.method||"get").toLowerCase(),data:i.data,serializer:"json"};i.customHeaders&&(t.debug("ajax[http] -> adding custom headers: "+JSON.stringify(i.customHeaders)),o.headers=i.customHeaders),t.debug("ajax[http] -> send request to "+i.url);const n=o=>{try{200==o.status?e.callExternal(t,"ajax.success",i.success,JSON.parse(o.data)):(t.warn("ajax[http] -> request to "+i.url+" failed with status "+o.status+" ("+o.error+")"),e.callExternal(t,"ajax.error",i.error,o.status,o.error))}catch(n){t.warn("ajax[http] -> request to "+i.url+" failed with an exception: "+n.message),i.error&&e.callExternal(t,"ajax.error",i.error,417,n.message)}e.callExternal(t,"ajax.done",r)};return window.cordova.plugin.http.sendRequest(i.url,o,n,n),{done:function(e){return r=e,this}}}(function(e){e.HTTP_REQUEST_TIMEOUT=408})(t=e.Ajax||(e.Ajax={})),e.ajax=i})(t=e.Utils||(e.Utils={}))}(e||(e={})),function(e){let t;(function(t){function i(t,i,r,...o){try{const t=Array.prototype.slice.call(arguments,3);r&&r.apply(e.store,t)}catch(n){t.logCallbackException(i,n)}}t.callExternal=i})(t=e.Utils||(e.Utils={}))}(e||(e={})),function(e){let t;(function(e){function t(e,t){return setTimeout(e,t)}function i(e,t){let i=null;const r=function(t,r){i=null,e()},o=function(){i&&window.clearTimeout(i),i=setTimeout(r,t)};return o}function r(e){return new Promise((t=>setTimeout(t,e)))}e.delay=t,e.debounce=i,e.asyncDelay=r})(t=e.Utils||(e.Utils={}))}(e||(e={})),function(e){let t;(function(t){function i(i){switch(r(i)){case e.RecurrenceMode.FINITE_RECURRING:return`${i.billingCycles}x ${t.formatDurationEN(i.billingPeriod)}`;case e.RecurrenceMode.NON_RECURRING:return"for "+t.formatDurationEN(i.billingPeriod);default:return"every "+t.formatDurationEN(i.billingPeriod,{omitOne:!0})}}function r(t){var i;const r=null!==(i=t.billingCycles)&&void 0!==i?i:0;if(t.recurrenceMode===e.RecurrenceMode.FINITE_RECURRING){if(1==r)return e.RecurrenceMode.NON_RECURRING;if(r<=0)return e.RecurrenceMode.INFINITE_RECURRING}return t.recurrenceMode}t.formatBillingCycleEN=i})(t=e.Utils||(e.Utils={}))}(e||(e={})),function(e){let t;(function(e){function t(e,t){if(!e)return"";const i=e.length,r=e.slice(1,i-1);if("1"===r)return(null===t||void 0===t?void 0:t.omitOne)?{D:"day",W:"week",M:"month",Y:"year"}[e[i-1]]||e[i-1]:{D:"1 day",W:"1 week",M:"1 month",Y:"1 year"}[e[i-1]]||e[i-1];{const t={D:"days",W:"weeks",M:"months",Y:"years"}[e[i-1]]||e[i-1];return`${r} ${t}`}}e.formatDurationEN=t})(t=e.Utils||(e.Utils={}))}(e||(e={})),function(e){let t;(function(e){const t="0123456789abcdef".split("");function i(e){for(var i="",r=0;r<4;r++)i+=t[e>>8*r+4&15]+t[e>>8*r&15];return i}function r(e){const t=[];for(var r=e.length,o=0;o<r;o++)t.push(i(e[o]));return t.join("")}function o(e,t){return e+t&4294967295}function n(e,t,i,r,n,s,a){function c(e,t,i){return o(e<<t|e>>>32-t,i)}function l(e,t,i,r){return o(o(t,e),o(i,r))}return c(l(e,t,r,s),n,i)}var s=function(e,t,i,r,o,s,a,c){return n(i&r|~i&o,t,i,s,a,c,e)},a=function(e,t,i,r,o,s,a,c){return n(i&o|r&~o,t,i,s,a,c,e)},c=function(e,t,i,r,o,s,a,c){return n(i^r^o,t,i,s,a,c,e)},l=function(e,t,i,r,o,s,a,c){return n(r^(i|~o),t,i,s,a,c,e)};function d(e,t,i){i||(i=o);let r=e[0],n=e[1],d=e[2],u=e[3];var p=s.bind(null,i);r=p(r,n,d,u,t[0],7,-680876936),u=p(u,r,n,d,t[1],12,-389564586),d=p(d,u,r,n,t[2],17,606105819),n=p(n,d,u,r,t[3],22,-1044525330),r=p(r,n,d,u,t[4],7,-176418897),u=p(u,r,n,d,t[5],12,1200080426),d=p(d,u,r,n,t[6],17,-1473231341),n=p(n,d,u,r,t[7],22,-45705983),r=p(r,n,d,u,t[8],7,1770035416),u=p(u,r,n,d,t[9],12,-1958414417),d=p(d,u,r,n,t[10],17,-42063),n=p(n,d,u,r,t[11],22,-1990404162),r=p(r,n,d,u,t[12],7,1804603682),u=p(u,r,n,d,t[13],12,-40341101),d=p(d,u,r,n,t[14],17,-1502002290),n=p(n,d,u,r,t[15],22,1236535329);var h=a.bind(null,i);r=h(r,n,d,u,t[1],5,-165796510),u=h(u,r,n,d,t[6],9,-1069501632),d=h(d,u,r,n,t[11],14,643717713),n=h(n,d,u,r,t[0],20,-373897302),r=h(r,n,d,u,t[5],5,-701558691),u=h(u,r,n,d,t[10],9,38016083),d=h(d,u,r,n,t[15],14,-660478335),n=h(n,d,u,r,t[4],20,-405537848),r=h(r,n,d,u,t[9],5,568446438),u=h(u,r,n,d,t[14],9,-1019803690),d=h(d,u,r,n,t[3],14,-187363961),n=h(n,d,u,r,t[8],20,1163531501),r=h(r,n,d,u,t[13],5,-1444681467),u=h(u,r,n,d,t[2],9,-51403784),d=h(d,u,r,n,t[7],14,1735328473),n=h(n,d,u,r,t[12],20,-1926607734);var f=c.bind(null,i);r=f(r,n,d,u,t[5],4,-378558),u=f(u,r,n,d,t[8],11,-2022574463),d=f(d,u,r,n,t[11],16,1839030562),n=f(n,d,u,r,t[14],23,-35309556),r=f(r,n,d,u,t[1],4,-1530992060),u=f(u,r,n,d,t[4],11,1272893353),d=f(d,u,r,n,t[7],16,-155497632),n=f(n,d,u,r,t[10],23,-1094730640),r=f(r,n,d,u,t[13],4,681279174),u=f(u,r,n,d,t[0],11,-358537222),d=f(d,u,r,n,t[3],16,-722521979),n=f(n,d,u,r,t[6],23,76029189),r=f(r,n,d,u,t[9],4,-640364487),u=f(u,r,n,d,t[12],11,-421815835),d=f(d,u,r,n,t[15],16,530742520),n=f(n,d,u,r,t[2],23,-995338651);var g=l.bind(null,i);r=g(r,n,d,u,t[0],6,-198630844),u=g(u,r,n,d,t[7],10,1126891415),d=g(d,u,r,n,t[14],15,-1416354905),n=g(n,d,u,r,t[5],21,-57434055),r=g(r,n,d,u,t[12],6,1700485571),u=g(u,r,n,d,t[3],10,-1894986606),d=g(d,u,r,n,t[10],15,-1051523),n=g(n,d,u,r,t[1],21,-2054922799),r=g(r,n,d,u,t[8],6,1873313359),u=g(u,r,n,d,t[15],10,-30611744),d=g(d,u,r,n,t[6],15,-1560198380),n=g(n,d,u,r,t[13],21,1309151649),r=g(r,n,d,u,t[4],6,-145523070),u=g(u,r,n,d,t[11],10,-1120210379),d=g(d,u,r,n,t[2],15,718787259),n=g(n,d,u,r,t[9],21,-343485551),e[0]=i(r,e[0]),e[1]=i(n,e[1]),e[2]=i(d,e[2]),e[3]=i(u,e[3])}function u(e){for(var t=[],i=0;i<64;i+=4)t[i>>2]=e.charCodeAt(i)+(e.charCodeAt(i+1)<<8)+(e.charCodeAt(i+2)<<16)+(e.charCodeAt(i+3)<<24);return t}function p(e,t){let i;const r=e.length,o=[1732584193,-271733879,-1732584194,271733878];for(i=64;i<=r;i+=64)d(o,u(e.substring(i-64,i)),t);const n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=(e=e.substring(i-64)).length;let a;for(a=0;a<s;a++)n[a>>2]|=e.charCodeAt(a)<<(a%4<<3);if(n[a>>2]|=128<<(a%4<<3),a>55)for(d(o,n,t),a=16;a--;)n[a]=0;return n[14]=8*r,d(o,n,t),o}function h(e){if(!e)return"";let t;return"5d41402abc4b2a76b9719d911017c592"!==r(p("hello"))&&(t=function(e,t){const i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}),r(p(e,t))}e.md5=h})(t=e.Utils||(e.Utils={}))}(e||(e={})),function(e){let t;(function(e){function t(e,t,r){return function(o){i(e,t,r,o)}}function i(e,t,i,r){setTimeout((()=>{try{e.debug(`Calling callback: type=${t} name=${i.name}`),i(r)}catch(o){e.error(`Error in callback: type=${t} name=${i.name}`);const r=o;"message"in r&&e.error(r.message),"fileName"in o&&e.error("in "+o.fileName+":"+o.lineNumber),"stack"in r&&e.error(r.stack)}}),0)}e.safeCallback=t,e.safeCall=i})(t=e.Utils||(e.Utils={}))}(e||(e={})),function(e){let t;(function(e){function t(){return window.crypto||window.msCrypto}function i(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^t().getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))}e.uuidv4=i})(t=e.Utils||(e.Utils={}))}(e||(e={})),function(e){let t;(function(t){let i;(function(t){function i(e){return"[object Array]"===Object.prototype.toString.call(e)}function r(e){return"[object Object]"===Object.prototype.toString.call(e)}function o(e){return"string"===typeof e.validator_privacy_policy?e.validator_privacy_policy.split(","):i(e.validator_privacy_policy)?e.validator_privacy_policy:["analytics","support","fraud"]}function n(t){const i=o(t);function n(e){return i.indexOf(e)>=0}const s={plugin:"cordova-plugin-purchase/"+e.PLUGIN_VERSION},a=window,c=r(a.device)?a.device:{};if(n("analytics")||n("support")){const e=a.Ionic||a.ionic;e&&e.version&&(s.ionic=e.version),c.cordova&&(s.cordova=c.cordova),c.model&&(s.model=c.model),c.platform&&(s.platform=c.platform),c.version&&(s.version=c.version),c.manufacturer&&(s.manufacturer=c.manufacturer)}if(n("tracking")&&(c.serial&&(s.serial=c.serial),c.uuid&&(s.uuid=c.uuid)),c.isVirtual&&(s.isVirtual=c.isVirtual),n("fraud")){var l="";c.serial?l="serial:"+c.serial:c.uuid?l="uuid:"+c.uuid:(c.model&&(l+="/"+c.model),c.manufacturer&&(l="/"+c.manufacturer)),l&&(s.fingerprint=e.Utils.md5(l))}return s}t.getDeviceInfo=n})(i=t.Internal||(t.Internal={}))})(t=e.Validator||(e.Validator={}))}(e||(e={})),function(e){let t;(function(e){let t;t=e.Request||(e.Request={})})(t=e.Validator||(e.Validator={}))}(e||(e={})),function(e){class t{constructor(e,t,i){var r;this.className="VerifiedReceipt",this.id=t.id,this.sourceReceipt=e,this.collection=null!==(r=t.collection)&&void 0!==r?r:[],this.latestReceipt=t.latest_receipt,this.nativeTransactions=[t.transaction],this.warning=t.warning,Object.defineProperty(this,"raw",{enumerable:!1,get(){return t}}),Object.defineProperty(this,"finish",{enumerable:!1,get(){return()=>i.finish(this)}})}get platform(){return this.sourceReceipt.platform}get raw(){return{}}set(e,t){var i;this.id=t.id,this.sourceReceipt=e,this.collection=null!==(i=t.collection)&&void 0!==i?i:[],this.latestReceipt=t.latest_receipt,this.nativeTransactions=[t.transaction],this.warning=t.warning}async finish(){}}e.VerifiedReceipt=t}(e||(e={}))},41817:(e,t,i)=>{var r=i(82109),o=i(19781),n=i(17854),s=i(1702),a=i(92597),c=i(60614),l=i(47976),d=i(41340),u=i(47045),p=i(99920),h=n.Symbol,f=h&&h.prototype;if(o&&c(h)&&(!("description"in f)||void 0!==h().description)){var g={},m=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:d(arguments[0]),t=l(f,this)?new h(e):void 0===e?h():h(e);return""===e&&(g[t]=!0),t};p(m,h),m.prototype=f,f.constructor=m;var P="Symbol(test)"==String(h("test")),y=s(f.valueOf),E=s(f.toString),I=/^Symbol\((.*)\)[^)]+$/,R=s("".replace),v=s("".slice);u(f,"description",{configurable:!0,get:function(){var e=y(this);if(a(g,e))return"";var t=E(e),i=P?v(t,7,-1):R(t,I,"$1");return""===i?void 0:i}}),r({global:!0,constructor:!0,forced:!0},{Symbol:m})}},78906:(e,t,i)=>{i.d(t,{Z:()=>g});var r=i(66252);function o(e,t,i,o,n,s){const a=(0,r.up)("ion-text"),c=(0,r.up)("ion-buttons"),l=(0,r.up)("ion-toolbar"),d=(0,r.up)("StoreCouponListItem"),u=(0,r.up)("ion-list"),p=(0,r.up)("CustomModalLayout"),h=(0,r.up)("ion-content"),f=(0,r.up)("ion-modal");return(0,r.wg)(),(0,r.j4)(f,{"is-open":i.isOpen,onIonModalDidDismiss:s.dismissedModal,onIonModalWillPresent:s.ionModalWillPresent,"initial-breakpoint":1,breakpoints:[0,1],class:"custom-modal slideup-modal"},{default:(0,r.w5)((()=>[(0,r.Wm)(h,null,{default:(0,r.w5)((()=>[(0,r.Wm)(p,{hideFooter:""},{header:(0,r.w5)((()=>[(0,r.Wm)(l,null,{default:(0,r.w5)((()=>[(0,r.Wm)(c,{slot:"start"},{default:(0,r.w5)((()=>[(0,r.Wm)(a,{class:"text-bold"},{default:(0,r.w5)((()=>[(0,r.Uk)("쿠폰보관함")])),_:1})])),_:1}),(0,r.Wm)(c,{slot:"end"},{default:(0,r.w5)((()=>[(0,r.Wm)(a,{onClick:s.dismissedModal},{default:(0,r.w5)((()=>[(0,r.Uk)(" 닫기")])),_:1},8,["onClick"])])),_:1})])),_:1})])),content:(0,r.w5)((()=>[(0,r.Wm)(u,{lines:"none"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(n.couponList,((e,t)=>((0,r.wg)(),(0,r.j4)(d,{key:t,item:e,icon:n.heartIcon},null,8,["item","icon"])))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["is-open","onIonModalDidDismiss","onIonModalWillPresent"])}var n=i(3577);function s(e,t,i,o,s,a){const c=(0,r.up)("ion-icon"),l=(0,r.up)("ion-text"),d=(0,r.up)("ion-label"),u=(0,r.up)("ion-item");return(0,r.wg)(),(0,r.j4)(u,null,{default:(0,r.w5)((()=>[i.icon?((0,r.wg)(),(0,r.j4)(c,{key:0,slot:"start",icon:i.icon},null,8,["icon"])):(0,r.kq)("",!0),(0,r.Wm)(d,null,{default:(0,r.w5)((()=>[(0,r.Wm)(l,{color:"light",class:"text-bold text-md"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(i.item.couponNm),1)])),_:1})])),_:1}),(0,r.Wm)(d,{slot:"end"},{default:(0,r.w5)((()=>[(0,r.Wm)(l,{color:"light",class:"text-bold text-md"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,n.zw)(i.item.quantity)+" 개",1)])),_:1})])),_:1})])),_:1})}const a={name:"StoreCouponListItem",props:{item:{type:Object},icon:{type:String}}};var c=i(83744);const l=(0,c.Z)(a,[["render",s],["__scopeId","data-v-72fd9904"]]),d=l;var u=i(28151),p=i(23675);const h={name:"StoreCouponModal",components:{StoreCouponListItem:d},props:{isOpen:{type:Boolean},icon:{type:String}},data(){return{heartIcon:p,couponList:[]}},methods:{dismissedModal(){this.$emit("dismissedModal")},ionModalWillPresent(){(0,u.Yu)({url:"/getUserCurrentCouponList",param:{},then:e=>{this.couponList=e}})}}},f=(0,c.Z)(h,[["render",o],["__scopeId","data-v-4b588fca"]]),g=f},80631:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(66252),o=i(3577);function n(e,t,i,n,s,a){const c=(0,r.up)("ion-icon"),l=(0,r.up)("ion-text"),d=(0,r.up)("ion-item");return(0,r.wg)(),(0,r.j4)(d,{lines:"none"},{default:(0,r.w5)((()=>[(0,r.Wm)(c,{icon:s.checkIcon,size:"large",color:"GOLD_PASS"===i.subscribedItem?"warning":"light"},null,8,["icon","color"]),(0,r.Wm)(l,{color:0===i.index||1===i.index&&"GOLD_PASS"===i.subscribedItem?"danger":"light",class:"text-bold text-sm"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(i.item),1)])),_:1},8,["color"])])),_:1})}var s=i(83105);const a={name:"SubscriptionDescItem",props:{item:{type:Object},index:{type:Number},subscribedItem:{type:String}},data(){return{checkIcon:s}}};var c=i(83744);const l=(0,c.Z)(a,[["render",n],["__scopeId","data-v-89403e14"]]),d=l},90069:(e,t,i)=>{i.r(t),i.d(t,{default:()=>_e});i(33948),i(41817);var r=i(66252),o=i(3577),n=i(49963);const s=e=>((0,r.dD)("data-v-679977b4"),e=e(),(0,r.Cn)(),e),a={class:"sticky-top segment-round"},c={class:"ion-padding"},l={class:"row-box"},d={class:"text-bold"},u={class:"row-box"},p=s((()=>(0,r._)("br",null,null,-1))),h={key:0,class:"row-box"},f=s((()=>(0,r._)("br",null,null,-1))),g=s((()=>(0,r._)("br",null,null,-1))),m={class:"text-center"};function P(e,t,i,s,P,y){const E=(0,r.up)("BackButton"),I=(0,r.up)("ion-buttons"),R=(0,r.up)("ion-title"),v=(0,r.up)("ion-toolbar"),C=(0,r.up)("ion-header"),A=(0,r.up)("ion-segment-button"),S=(0,r.up)("ion-segment"),T=(0,r.up)("ion-icon"),b=(0,r.up)("ion-chip"),N=(0,r.up)("ion-text"),w=(0,r.up)("ion-list-header"),O=(0,r.up)("StorePurchaseListItem"),_=(0,r.up)("ion-list"),D=(0,r.up)("StoreVoteList"),k=(0,r.up)("StoreListHeader"),L=(0,r.up)("StoreListItem"),U=(0,r.up)("ion-col"),M=(0,r.up)("ion-row"),B=(0,r.up)("ion-grid"),x=(0,r.up)("StoreSubscribedListItem"),V=(0,r.up)("ion-content"),F=(0,r.up)("ion-footer"),W=(0,r.up)("StoreCouponModal"),G=(0,r.up)("TermsModal"),q=(0,r.up)("ion-page");return(0,r.wg)(),(0,r.j4)(q,null,{default:(0,r.w5)((()=>[(0,r.Wm)(C,null,{default:(0,r.w5)((()=>[(0,r.Wm)(v,null,{default:(0,r.w5)((()=>[(0,r.Wm)(I,{slot:"start"},{default:(0,r.w5)((()=>[(0,r.Wm)(E)])),_:1}),(0,r.Wm)(R,null,{default:(0,r.w5)((()=>[(0,r.Uk)("Store")])),_:1})])),_:1})])),_:1}),(0,r.Wm)(V,null,{default:(0,r.w5)((()=>[(0,r._)("div",a,[(0,r.Wm)(S,{modelValue:P.categoryCd,"onUpdate:modelValue":t[0]||(t[0]=e=>P.categoryCd=e),mode:"md",scrollable:!0,class:"segment-round-button"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(P.categoryList,(e=>(0,r.wy)(((0,r.wg)(),(0,r.j4)(A,{value:e.categoryCd,onClick:t=>y.categoryBtn(e),key:e.categoryCd},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.categoryNm),1)])),_:2},1032,["value","onClick"])),[[n.F8,null!=P.categoryList]]))),128)),(0,r.wy)((0,r.Wm)(A,null,null,512),[[n.F8,null==P.categoryList]])])),_:1},8,["modelValue"])]),(0,r._)("div",c,[(0,r._)("div",l,[(0,r.Wm)(v,{style:{"--min-height":"40px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(I,{slot:"start",class:"my-point"},{default:(0,r.w5)((()=>[(0,r.Wm)(T,{icon:P.heartIcon,size:"large"},null,8,["icon"]),(0,r.Wm)(b,{color:"light",class:"shape-round text-sm"},{default:(0,r.w5)((()=>[(0,r._)("strong",d,(0,o.zw)(y.userPoint?y.userPoint:0),1)])),_:1})])),_:1}),(0,r.Wm)(I,{slot:"end"},{default:(0,r.w5)((()=>[(0,r.Wm)(b,{color:"light",class:"shape-round text-sm",onClick:t[1]||(t[1]=e=>P.modalOpen=!0)},{default:(0,r.w5)((()=>[(0,r.Uk)("쿠폰보관함 ")])),_:1})])),_:1})])),_:1})]),(0,r._)("div",u,["HEART"===P.categoryCd?((0,r.wg)(),(0,r.j4)(_,{key:0,lines:"none"},{default:(0,r.w5)((()=>[(0,r.Wm)(w,null,{default:(0,r.w5)((()=>[(0,r.Wm)(N,{color:"light"},{default:(0,r.w5)((()=>[(0,r.Uk)("충전하기")])),_:1})])),_:1}),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(P.storeItemList,((e,t)=>((0,r.wg)(),(0,r.j4)(O,{key:t,icon:P.heartIcon,item:e,index:t,onClick:t=>y.startInAppPurchase(e)},null,8,["icon","item","index","onClick"])))),128))])),_:1})):(0,r.kq)("",!0),"ITEM"===P.categoryCd?((0,r.wg)(),(0,r.j4)(_,{key:1,lines:"none"},{default:(0,r.w5)((()=>[(0,r.Wm)(w,null,{default:(0,r.w5)((()=>[(0,r.Wm)(N,{color:"light"},{default:(0,r.w5)((()=>[(0,r.Uk)("기간한정")])),_:1})])),_:1}),y.storeVoteFilteredList.length>0?((0,r.wg)(!0),(0,r.iD)(r.HY,{key:0},(0,r.Ko)(y.storeVoteFilteredList,((e,t)=>((0,r.wg)(),(0,r.iD)("div",{key:t,class:"row-box"},[(0,r.Wm)(D,{"item-list":e.values,title:e.title,onItemConfirmBtn:y.itemConfirmBtn},null,8,["item-list","title","onItemConfirmBtn"])])))),128)):(0,r.kq)("",!0),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(y.storeFilteredList,((e,t)=>((0,r.wg)(),(0,r.iD)("div",{key:t,class:"row-box"},[(0,r.Wm)(k,{item:e,title:e.title,icon:P.storeIconList[e.key]},null,8,["item","title","icon"]),(0,r.Wm)(B,{class:"gap-md"},{default:(0,r.w5)((()=>[(0,r.Wm)(M,null,{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.values,((t,i)=>((0,r.wg)(),(0,r.j4)(U,{size:"6",key:i,style:{padding:"8px 3px 8px 3px"}},{default:(0,r.w5)((()=>[(0,r.Wm)(L,{item:t,title:e.title,onClick:e=>y.itemConfirmBtn(t,"USE")},null,8,["item","title","onClick"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)])))),128))])),_:1})):(0,r.kq)("",!0),"SUBSCRIBE"===P.categoryCd?((0,r.wg)(),(0,r.j4)(_,{key:2,lines:"none"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(P.storeItemList,((e,t)=>((0,r.wg)(),(0,r.j4)(x,{key:t,selected:P.selected,item:e,onClick:t=>y.startInAppPurchase(e)},null,8,["selected","item","onClick"])))),128))])),_:1})):(0,r.kq)("",!0),"PACKAGE"===P.categoryCd?((0,r.wg)(),(0,r.j4)(_,{key:3,lines:"none"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(P.storeItemList,((e,t)=>((0,r.wg)(),(0,r.j4)(L,{key:t,onClick:t=>y.itemConfirmBtn(e,"BUY")},{content:(0,r.w5)((()=>[(0,r._)("div",null,[(0,r.Wm)(N,{color:"light",class:"text-bold text-lg"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.itemNm),1)])),_:2},1024),p,(0,r.Wm)(N,{color:"warning",class:"text-xs"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.description),1)])),_:2},1024)])])),price:(0,r.w5)((()=>[(0,r.Wm)(N,{color:"light",class:"text-md text-bold"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(e.priceWon)+" 원 ",1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):(0,r.kq)("",!0)])])])),_:1}),(0,r.Wm)(F,null,{default:(0,r.w5)((()=>["SUBSCRIBE"===P.categoryCd?((0,r.wg)(),(0,r.iD)("div",h,[(0,r.Wm)(N,{color:"light",class:"text-sm"},{default:(0,r.w5)((()=>[(0,r.Uk)(" 구독 서비스는 회원님이 앱스토어 설정에서 직접 취소할 때까지 "),f,(0,r.Uk)(" 동일한 패키지 기간, 동일한 가격으로 자동 갱신되며,"),g,(0,r.Uk)(' "네이비" 이용약관에 동의하게 됩니다. ')])),_:1})])):(0,r.kq)("",!0),(0,r._)("div",m,[(0,r.Wm)(N,{color:"light",class:"text-sm"},{default:(0,r.w5)((()=>[(0,r._)("span",{onClick:t[2]||(t[2]=(0,n.iM)((e=>y.terms("a")),["stop"]))},"이용약관"),(0,r.Uk)(" / "),(0,r._)("span",{onClick:t[3]||(t[3]=(0,n.iM)((e=>y.terms("b")),["stop"]))},"개인정보 취급방침"),(0,r.Uk)(" / "),(0,r._)("span",{onClick:t[4]||(t[4]=(0,n.iM)((e=>y.purchaseRecovery()),["stop"]))},"구매복구")])),_:1})])])),_:1}),(0,r.Wm)(W,{"is-open":P.modalOpen,onDismissedModal:t[5]||(t[5]=e=>P.modalOpen=!1)},null,8,["is-open"]),(0,r.Wm)(G,{"is-open":P.termModalOpen,termsTitle:P.termsTitle,termsType:P.termsType,onIonModalDidDismiss:t[6]||(t[6]=e=>P.termModalOpen=!1)},null,8,["is-open","termsTitle","termsType"])])),_:1})}i(74916),i(57658),i(38862);var y=i(28151);function E(e,t,i,n,s,a){const c=(0,r.up)("ion-text"),l=(0,r.up)("ion-icon"),d=(0,r.up)("ion-list-header");return(0,r.wg)(),(0,r.j4)(d,null,{default:(0,r.w5)((()=>["IT012"!=i.item.key?((0,r.wg)(),(0,r.j4)(c,{key:0,color:"light"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(i.title),1)])),_:1})):((0,r.wg)(),(0,r.j4)(c,{key:1,color:"light"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(i.title)+" ( "+(0,o.zw)(3-i.item.values[0].buyCnt)+"/3 )",1)])),_:1})),(0,r.Wm)(l,{icon:i.icon},null,8,["icon"])])),_:1})}const I={name:"StoreListHeader",props:{title:{type:String},icon:{type:String},item:{type:Object}}};var R=i(83744);const v=(0,R.Z)(I,[["render",E],["__scopeId","data-v-8c2a81b0"]]),C=v,A=e=>((0,r.dD)("data-v-4c743860"),e=e(),(0,r.Cn)(),e),S={class:"store-list-item"},T=A((()=>(0,r._)("br",null,null,-1))),b=A((()=>(0,r._)("br",null,null,-1))),N={class:"bonus-label"};function w(e,t,i,n,s,a){const c=(0,r.up)("ion-img"),l=(0,r.up)("ion-text"),d=(0,r.up)("ion-icon"),u=(0,r.up)("ion-chip"),p=(0,r.up)("ion-label"),h=(0,r.up)("StoreBonusLabel");return(0,r.wg)(),(0,r.iD)("div",S,[null!==i.item.cdnNm?((0,r.wg)(),(0,r.j4)(c,{key:0,src:"https://"+i.item.cdnNm,style:{}},null,8,["src"])):((0,r.wg)(),(0,r.j4)(c,{key:1,src:s.superLikeGift},null,8,["src"])),(0,r.Wm)(p,null,{default:(0,r.w5)((()=>[(0,r.Wm)(l,{color:"light",class:"text-bold text-sm"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(i.title),1)])),_:1}),T,(0,r.Wm)(l,{class:"text-sm sub-text05"},{default:(0,r.w5)((()=>["IT012_03"!=i.item.itemCd?((0,r.wg)(),(0,r.iD)(r.HY,{key:0},[(0,r.Uk)((0,o.zw)(i.title)+" + ",1),(0,r._)("strong",null,(0,o.zw)(i.item.sumPayment),1),(0,r.Uk)("개 ")],64)):((0,r.wg)(),(0,r.iD)(r.HY,{key:1},[(0,r.Uk)((0,o.zw)(i.item.itemNm)+" ",1)],64))])),_:1}),b,(0,r.Wm)(u,{color:"light",class:"shape-round text-xs"},{default:(0,r.w5)((()=>[(0,r.Uk)("구매 "),(0,r.Wm)(d,{icon:s.heartIcon},null,8,["icon"]),(0,r.Uk)(" "+(0,o.zw)(i.item.priceHeart)+" 개 ",1)])),_:1})])),_:1}),(0,r._)("div",N,[(0,r.Wm)(h,{percent:i.item.bonusRate,index:3},null,8,["percent"])])])}const O={key:0,class:"bonus"};function _(e,t,i,n,s,a){const c=(0,r.up)("ion-text");return i.percent>0?((0,r.wg)(),(0,r.iD)("div",O,[(0,r._)("div",null,[i.index>0?((0,r.wg)(),(0,r.iD)("span",{key:0,class:"bg-opacity",style:(0,o.j5)({opacity:1-(i.index+4)/5*.5})},null,4)):(0,r.kq)("",!0),(0,r.Wm)(c,{color:"light",class:"text-sm"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(i.percent)+"% ",1)])),_:1})])])):(0,r.kq)("",!0)}const D={name:"StoreBonusLabel",props:{index:{type:Number,default:0},percent:{type:Number}}},k=(0,R.Z)(D,[["render",_],["__scopeId","data-v-38c08d33"]]),L=k;var U=i(66247),M=i(23675);const B={name:"StoreListItem",props:{icon:{type:String},title:{type:String},item:{type:Object}},components:{StoreBonusLabel:L},data(){return{superLikeGift:U,heartIcon:M}}},x=(0,R.Z)(B,[["render",w],["__scopeId","data-v-4c743860"]]),V=x,F={class:"chip"},W={class:"inner"},G={class:"content"},q={class:"price"},Y={class:"bonus-label"};function j(e,t,i,n,s,a){const c=(0,r.up)("ion-chip"),l=(0,r.up)("ion-icon"),d=(0,r.up)("ion-text"),u=(0,r.up)("StoreBonusLabel");return(0,r.wg)(),(0,r.iD)("div",{class:(0,o.C_)(["store-list-item",{"is-hot":"navy_heart_item365"===i.item.productId}])},[(0,r._)("div",F,["navy_heart_item365"===i.item.productId?((0,r.wg)(),(0,r.j4)(c,{key:0},{default:(0,r.w5)((()=>[(0,r.Uk)("HOT")])),_:1})):(0,r.kq)("",!0)]),(0,r._)("div",W,[(0,r._)("div",G,[i.icon?((0,r.wg)(),(0,r.j4)(l,{key:0,icon:i.icon},null,8,["icon"])):(0,r.kq)("",!0),(0,r.Wm)(d,{color:"light"},{default:(0,r.w5)((()=>[(0,r.Uk)(" 하트 "+(0,o.zw)(s.itemNameList[i.index])+" ( "+(0,o.zw)(i.item.payment+i.item.bonus)+"개 ) ",1)])),_:1})]),(0,r._)("div",q,[(0,r.Wm)(d,{color:"light"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(i.item.priceWon)+"원 ",1)])),_:1})])]),(0,r._)("div",Y,[a.percent>0?((0,r.wg)(),(0,r.j4)(u,{key:0,percent:i.item.bonusRate,index:i.index},null,8,["percent","index"])):(0,r.kq)("",!0)])],2)}const K={name:"StorePurchaseListItem",components:{StoreBonusLabel:L},props:{icon:{type:String},item:{type:Object},index:{type:Number}},computed:{percent(){return Math.floor(this.item.bonus/this.item.payment*100)}},data(){return{itemNameList:["한 쪽","한 줄","주머니","바구니","상자","더미"]}}},z=(0,R.Z)(K,[["render",j],["__scopeId","data-v-57399413"]]),H=z;i(15306);const J=["id"],Z={class:"row-box"},Q={class:"info-area"},X={class:"inner"},$={class:"price-area"},ee={class:"inner"},te={class:"text-md"},ie={key:0,class:"row-box"};function re(e,t,i,n,s,a){const c=(0,r.up)("ion-chip"),l=(0,r.up)("ion-text"),d=(0,r.up)("ion-card"),u=(0,r.up)("SubscriptionDescItem"),p=(0,r.up)("ion-list"),h=(0,r.up)("CardBox");return(0,r.wg)(),(0,r.iD)("div",{class:(0,o.C_)(["subscription-item",{"is-selected":i.selected===i.item.itemCd}]),id:i.item.itemCd},[(0,r._)("div",Z,[(0,r.Wm)(d,{class:"ticket"},{default:(0,r.w5)((()=>[(0,r._)("div",Q,[(0,r._)("div",X,[(0,r.Wm)(l,{color:"light"},{default:(0,r.w5)((()=>[(0,r._)("h5",null,[(0,r._)("strong",null,(0,o.zw)(i.item.itemCd.replace("_"," ")),1),(0,r.Wm)(c,{color:"warning",class:(0,o.C_)("GOLD_PASS"===i.item.itemCd?"chip-hot":"chip-popular")},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)("GOLD_PASS"===i.item.itemCd?"HOT":"가성비"),1)])),_:1},8,["class"])])])),_:1})])]),(0,r._)("div",$,[(0,r._)("div",ee,[(0,r.Wm)(l,{color:"light"},{default:(0,r.w5)((()=>[(0,r._)("strong",te,(0,o.zw)(i.item.priceWon)+" 원 / 1개월",1)])),_:1})])])])),_:1})]),a.descriptionList&&a.descriptionList.length>0?((0,r.wg)(),(0,r.iD)("div",ie,[(0,r.Wm)(h,{shadow:"GOLD_PASS"===i.item.itemCd&&"gold"},{default:(0,r.w5)((()=>[(0,r.Wm)(p,{lines:"none"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(a.descriptionList,((e,t)=>((0,r.wg)(),(0,r.j4)(u,{key:t,index:t,item:e,subscribedItem:i.item.itemCd},null,8,["index","item","subscribedItem"])))),128))])),_:1})])),_:1},8,["shadow"])])):(0,r.kq)("",!0)],10,J)}var oe=i(80631);const ne={name:"SubscriptionItem",components:{SubscriptionDescItem:oe.Z},props:{selected:{type:String},item:{type:Object}},computed:{descriptionList(){if(this.item.description){const e=this.item.description;let t=e.split(",");return t}return[]}}},se=(0,R.Z)(ne,[["render",re],["__scopeId","data-v-31980ae2"]]),ae=se;function ce(e,t,i,o,n,s){const a=(0,r.up)("StoreVoteListItem"),c=(0,r.up)("swiper-slide"),l=(0,r.up)("swiper");return(0,r.wg)(),(0,r.j4)(l,{modules:n.modules,"free-mode":!0,"space-between":16,"slides-per-view":"auto"},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(i.itemList,((e,t)=>((0,r.wg)(),(0,r.j4)(c,{key:t},{default:(0,r.w5)((()=>[((0,r.wg)(),(0,r.j4)(a,{key:t,item:e,title:i.title,onItemConfirmBtn:t=>s.itemConfirmBtn(e)},null,8,["item","title","onItemConfirmBtn"]))])),_:2},1024)))),128))])),_:1},8,["modules"])}var le=i(57552),de=i(99304);const ue={class:"item"},pe={class:"item-name"},he={class:"price"};function fe(e,t,i,n,s,a){const c=(0,r.up)("ion-chip"),l=(0,r.up)("ion-img"),d=(0,r.up)("ion-text"),u=(0,r.up)("ion-icon");return(0,r.wg)(),(0,r.iD)("div",{class:"store-list-item",onClick:t[0]||(t[0]=e=>a.itemConfirmBtn(i.item))},[(0,r.Wm)(c,{class:"chip-buy-count shape-round"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,o.zw)(3-i.item.buyCnt)+"/3 ",1)])),_:1}),(0,r._)("div",ue,[null!==i.item.cdnNm?((0,r.wg)(),(0,r.j4)(l,{key:0,src:"https://"+i.item.cdnNm,style:{}},null,8,["src"])):((0,r.wg)(),(0,r.j4)(l,{key:1,src:s.superLikeGift},null,8,["src"])),(0,r._)("div",pe,[(0,r.Wm)(d,{color:"light",class:"text-bold text-sm"},{default:(0,r.w5)((()=>[(0,r.Uk)(" 컨테스트 "+(0,o.zw)(i.title),1)])),_:1}),(0,r.Wm)(c,{color:"light",class:"chip-vote-count"},{default:(0,r.w5)((()=>[(0,r.Uk)(" 투표권 "+(0,o.zw)(i.item.sumPayment)+"장 ",1)])),_:1})])]),(0,r._)("div",he,[(0,r.Wm)(u,{icon:s.heartIcon},null,8,["icon"]),(0,r.Wm)(d,{color:"light"},{default:(0,r.w5)((()=>[(0,r._)("strong",null,(0,o.zw)(i.item.priceHeart)+" 개",1)])),_:1})])])}const ge={name:"StoreVoteListItem",props:{icon:{type:String},title:{type:String},item:{type:Object}},data(){return{modules:[de.Rv,de.pt,de.tl,de.W_],superLikeGift:U,heartIcon:M}},methods:{itemConfirmBtn(e){this.$emit("itemConfirmBtn",e)}}},me=(0,R.Z)(ge,[["render",fe],["__scopeId","data-v-7fda8c20"]]),Pe=me,ye={name:"StoreVoteList",components:{StoreVoteListItem:Pe,Swiper:le.tq,SwiperSlide:le.o5},props:{itemList:{type:Array},title:{type:String}},data(){return{modules:[de.Rv,de.pt,de.tl,de.W_]}},methods:{itemConfirmBtn(e){this.$emit("itemConfirmBtn",e,"USE")}}},Ee=(0,R.Z)(ye,[["render",ce],["__scopeId","data-v-1d4a3895"]]),Ie=Ee;var Re=i(78906);function ve(e,t,o,n,s,a){const c=(0,r.up)("ion-img"),l=(0,r.up)("swiper-slide"),d=(0,r.up)("swiper");return(0,r.wg)(),(0,r.j4)(d,{onSwiper:a.setSwiperRef,modules:s.modules,pagination:{clickable:!0},"slides-per-view":1,autoplay:{delay:3e3,disableOnInteraction:!1},loop:!0,observer:!0},{default:(0,r.w5)((()=>[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(o.bannerList,((e,o)=>((0,r.wg)(),(0,r.j4)(l,{key:o},{default:(0,r.w5)((()=>[(0,r.Wm)(c,{src:""!==e.cdnNm&&null!==e.cdnNm?"https://"+e.cdnNm:i(7189),onIonError:t[0]||(t[0]=e=>e.srcElement.src=i(7189)),onClick:t=>a.routerPush(e.path)},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:1},8,["onSwiper","modules"])}const Ce={name:"StoreBanner",props:{bannerList:{type:Array}},components:{Swiper:le.tq,SwiperSlide:le.o5},data(){return{modules:[de.pt,de.tl,de.W_],swiperRef:null}},mounted(){},beforeMount(){},beforeUpdate(){},updated(){console.log(this.swiperRef),null!=this.swiperRef&&this.swiperRef.slideNext(2e3)},beforeUnmount(){},methods:{routerPush(e){""!=e&&null!=e&&("/subscription"==e?this.$emit("storeCategory"):this.$router.push(e))},setSwiperRef(e){this.swiperRef=e}}},Ae=(0,R.Z)(Ce,[["render",ve],["__scopeId","data-v-7a2b223e"]]),Se=Ae;var Te=i(74676),be=i(7280),Ne=(i(20892),i(29895));const we={name:"Store",inject:["alertController","loadingController"],components:{StoreCouponModal:Re.Z,StoreListHeader:C,StoreListItem:V,StorePurchaseListItem:H,StoreSubscribedListItem:ae,StoreVoteList:Ie,TermsModal:Te.Z,StoreBanner:Se},computed:{storeFilteredList(){const e=[],t=/^([A-Za-z0-9]+)_/;for(const i of this.storeItemList)if("Y"===i.showYn){const r=t.exec(i.itemCd);if(r){const t=r[1],o=i.itemNm.split("(")[0],n=e.find((e=>e.key===t));n?n.values.push(i):e.push({key:t,title:o,values:[i]})}}return console.log("result",e),e},storeVoteFilteredList(){const e=[],t=/^([A-Za-z0-9]+)_/;for(const i of this.storeItemList)if("Y"===i.contestYn){const r=t.exec(i.itemCd);if(r){const t=r[1],o=i.itemNm.split("(")[0],n=e.find((e=>e.key===t));n?n.values.push(i):e.push({key:t,title:o,values:[i]})}}return console.log("result",e),e},userPoint(){return this.$store.state.userPoint}},data(){return{heartIcon:M,storeIconList:{IT001:be},segmentValue:"light",categoryCd:"",categoryList:[],storeItemList:[],heartCd:"",heartSum:"",type:"",termsTitle:"",termsType:"",termModalOpen:!1,modalOpen:!1,bannerList:[],selected:null,subscribedPlan:"NAVY_PLUS"}},ionViewWillEnter(){this.getCategoryList(),this.getUserLastPoint(),this.getBannerList()},ionViewDidLeave(){(0,y.EY)({})},mounted(){"web"!==Ne.dV.getPlatform()&&(CdvPurchase.store.get("navy_heart_item60","ios"==Ne.dV.getPlatform()?CdvPurchase.Platform.APPLE_APPSTORE:CdvPurchase.Platform.GOOGLE_PLAY)||this.initStore())},methods:{initStore(){(0,y.Yu)({url:"/getStoreInitList",param:{},then:e=>{for(let i in e)console.log("등록 시작! ["+i+"]"),"subscribe"==e[i]["buyType"]?CdvPurchase.store.register({id:e[i]["productId"],type:CdvPurchase.ProductType.PAID_SUBSCRIPTION,platform:"ios"==Ne.dV.getPlatform()?CdvPurchase.Platform.APPLE_APPSTORE:CdvPurchase.Platform.GOOGLE_PLAY}):CdvPurchase.store.register({id:e[i]["productId"],type:CdvPurchase.ProductType.CONSUMABLE,platform:"ios"==Ne.dV.getPlatform()?CdvPurchase.Platform.APPLE_APPSTORE:CdvPurchase.Platform.GOOGLE_PLAY});const t=new CdvPurchase.Iaptic({appName:"cmdg.navy.client",apiKey:"c83df663-2e86-4db5-98f7-5e0657d7f537"});CdvPurchase.store.validator=t.validator,CdvPurchase.store.applicationUsername=()=>"demo-user",CdvPurchase.store.when().approved((e=>{console.log("approved : "+e),"cmdg.navy.client"==e.products[0]["id"]&&"finished"==e.state||alert(" approved :: "+JSON.stringify(e)),e.verify()})).verified((e=>{console.log("verified : "+e),alert(" verified :: "+JSON.stringify(e)),e.finish()})).finished((e=>{alert("finished"+JSON.stringify(e))})).pending((e=>{alert("pending"+JSON.stringify(e))})).unverified((e=>{alert("unverified"+JSON.stringify(e))})).receiptsReady((e=>{})).receiptsVerified((e=>{})).receiptUpdated((e=>{})).productUpdated((e=>{})),CdvPurchase.store.initialize([{platform:CdvPurchase.Platform.APPLE_APPSTORE,options:{needAppReceipt:!0,discountEligibilityDeterminer:t.appStoreDiscountEligibilityDeterminer}},CdvPurchase.Platform.GOOGLE_PLAY])}})},orderOffer(e,t,i){var r;const o=CdvPurchase.store,n=null===(r=o.get(t,e))||void 0===r?void 0:r.getOffer(i);n&&o.order(n)},startInAppPurchase(e){let t=e.productId;console.log("구매시작 : "+t),"web"!==Ne.dV.getPlatform()?CdvPurchase.store.ready((()=>{const e=CdvPurchase.store.get(t,"ios"==Ne.dV.getPlatform()?CdvPurchase.Platform.APPLE_APPSTORE:CdvPurchase.Platform.GOOGLE_PLAY);e.canPurchase&&CdvPurchase.store.order(e.getOffer())})):alert("웹에서는 구매할 수 없습니다.")},setHartBuyToFinish(e){(0,y.Yu)({url:"/setBuyHeart",param:this.setItemBuyForm(e,"BUY"),then:e=>{"N"===e.successYn?alert(e.message):this.$store.state.userPoint=e.lastPoint,this.$store.state.loading.dismiss()}})},getStoreItemListForm(){var e={};return e.categoryCd=this.categoryCd,e},setItemBuyForm(e,t){var i={};return i.itemCd=e.itemCd,i.pointCd=t,i.subscribeCd=e.itemCd,i},getCategoryList(){(0,y.Yu)({url:"/getStoreCategoryList",param:{},then:e=>{this.categoryList=e,""===this.categoryCd&&e.length>0&&(this.categoryCd=e[0].categoryCd,void 0!=y.Eh.subscribeYn&&null!=y.Eh.subscribeYn&&(this.categoryCd="SUBSCRIBE"),"item"==y.Eh.categoryType&&(this.categoryCd="ITEM")),this.$nextTick((()=>{this.getItemList()}))}})},getItemList(){this.storeItemList=[],(0,y.Yu)({url:"/getStoreItemList",param:this.getStoreItemListForm(),then:e=>{this.storeItemList=e}})},getUserLastPoint(){(0,y.Yu)({url:"/getUserLastPoint",param:{},then:e=>{this.$store.state.userPoint=e.lastPoint}})},getBannerList(){(0,y.Yu)({url:"/getBannerList",param:{bannerType:"HOME"},then:e=>{this.$nextTick((()=>{this.bannerList=e}))}})},storeCategory(){this.categoryCd="SUBSCRIBE"},async heartConfirmBtn(e){const t=await this.alertController.create({header:"",message:"하트 "+e.sumPayment+" 개를 정말 구매하시겠습니까?",buttons:[{text:"취소",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"구매",handler:()=>{this.showLoading(),(0,y.Yu)({url:"/setBuyHeart",param:this.setItemBuyForm(e,"BUY"),then:e=>{"N"===e.successYn?this.warningAlert(e.message):(this.warningAlert(e.message),this.userPoint=e.lastPoint),this.loading.dismiss()}})}}]});return t.present()},finishSubscribe(e){(0,y.Yu)({url:"/buySubscribeComplete",param:this.setItemBuyForm(e,"BUY"),then:e=>{"NE"===e.successYn?this.warningAlert(e.message):"NH"===e.successYn||(this.warningAlert(e.message),e.lastPoint),this.$store.state.loading.dismiss()}})},async itemConfirmBtn(e,t){let i="";"ITEM"===this.categoryCd?i="/setBuyItem":"PACKAGE"===this.categoryCd?i="/setBuyPackage":"SUBSCRIBE"===this.categoryCd&&(i="/buySubscribeComplete");const r=await this.alertController.create({header:"",message:e.itemNm+" 을 정말 구매하시겠습니까?",buttons:[{text:"취소",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"구매",handler:()=>{this.showLoading(),(0,y.Yu)({url:i,param:this.setItemBuyForm(e,t),then:e=>{if("NE"===e.successYn)this.warningAlert(e.message);else if("NH"===e.successYn)this.heartPageConfirmBtn(e);else if(this.warningAlert(e.message),void 0!=e.lastPoint&&(this.$store.state.userPoint=e.lastPoint),void 0!=e.buyCnt)for(let t=0;this.storeFilteredList.length>t;t++)if("IT012"==this.storeFilteredList[t].key){this.storeFilteredList[t].values[0].buyCnt=e.buyCnt;break}this.loading.dismiss()}})}}]});return r.present()},async heartPageConfirmBtn(e){const t=await this.alertController.create({header:"",message:e.message,buttons:[{text:"취소",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"이동",handler:()=>{this.categoryCd=this.categoryList[0].categoryCd,this.getItemList()}}]});return t.present()},async warningAlert(e){const t=await this.alertController.create({header:"",subHeader:"",message:e,buttons:["OK"]});return t.present()},categoryBtn(e){this.categoryCd=e.categoryCd,this.getItemList()},terms(e){"a"===e?(this.termsType="service",this.termsTitle="서비스 이용약관"):"b"===e?(this.termsType="info",this.termsTitle="개인정보 보호정책"):"c"===e?(this.termsType="marketing",this.termsTitle="홍보 및 마케팅 목적"):"d"===e&&(this.termsType="push",this.termsTitle="광고성 정보 수신"),this.termModalOpen=!0},purchaseRecovery(){(0,y.Yu)({url:"/purchase/purchaseRecoveryOne",param:{},then:e=>{null!=e?CdvPurchase.store.order(e.productId).then((()=>{alert("처리되었습니다.")})):alert("처리되었습니다.")}})},async showLoading(){this.loading=await this.loadingController.create({message:"Loading...",duration:0}),await this.loading.present()},async showLoadingStore(){this.$store.state.loading=await this.loadingController.create({message:"Loading...",duration:0}),await this.$store.state.loading.present()}}},Oe=(0,R.Z)(we,[["render",P],["__scopeId","data-v-679977b4"]]),_e=Oe},83105:(e,t,i)=>{e.exports=i.p+"img/icon_check.803ad7bb.svg"},23675:(e,t,i)=>{e.exports=i.p+"img/icon_store_heart.3689781f.svg"},7280:(e,t,i)=>{e.exports=i.p+"img/superlike.be776f5a.svg"},7189:(e,t,i)=>{e.exports=i.p+"img/Loading_icon.f0448993.gif"},66247:e=>{e.exports="data:image/png;base64,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"}}]);
//# sourceMappingURL=69.8fd62cae.js.map